[{"filePath":"C:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\customers\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\customers\\[id]\\page.tsx:86:13\n  84 |\n  85 |   useEffect(() => {\n> 86 |     if (id) fetchCustomerDetails();\n     |             ^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  87 |   }, [id, fetchCustomerDetails]);\n  88 |\n  89 |   const handleSave = async () => {","line":86,"column":13,"nodeType":null,"endLine":86,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport { createClient } from \"@/utils/supabase/client\";\nimport { useParams, useRouter } from \"next/navigation\";\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  ArrowLeft,\n  Phone,\n  MapPin,\n  Save,\n  ShieldCheck,\n  ShieldAlert,\n  Clock,\n  MessageCircle,\n  X,\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport ChickenLoader from \"@/components/ui/chicken-loader\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport type { Customer, OrderWithRelations } from \"@/types/orders\"; // Re-using existing types where possible\n\nimport { Icon } from \"@/components/ui/Icon\";\nimport { clsx } from \"clsx\";\n\nexport default function CustomerDetailsPage() {\n  const params = useParams();\n  const id = params?.id as string;\n  const router = useRouter();\n  const supabase = createClient();\n\n  const [customer, setCustomer] = useState<Customer | null>(null);\n  const [orders, setOrders] = useState<OrderWithRelations[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [notes, setNotes] = useState(\"\");\n  const [reliability, setReliability] = useState(100);\n  const [tags, setTags] = useState<string[]>([]);\n  const [newTag, setNewTag] = useState(\"\");\n\n  const fetchCustomerDetails = useCallback(async () => {\n    setLoading(true);\n\n    // Fetch Customer\n    const { data: custData, error: custError } = await (supabase as any)\n      .from(\"customers\")\n      .select(\n        \"id, full_name, phone, notes, tags, total_spent, total_orders, reliability_score, wilaya, commune\",\n      )\n      .eq(\"id\", id)\n      .single();\n\n    if (custError || !custData) {\n      toast.error(\"Customer not found\");\n      router.push(\"/customers\");\n      return;\n    }\n\n    // Fetch Orders - Using standardized total_amount\n    const { data: ordData, error: ordError } = await (supabase as any)\n      .from(\"orders\")\n      .select(\n        \"id, product_name, category, created_at, total_amount, quantity, status\",\n      )\n      .eq(\"customer_id\", id)\n      .order(\"created_at\", { ascending: false });\n\n    setCustomer(custData as Customer);\n    setNotes(custData.notes || \"\");\n    setReliability(custData.reliability_score || 100);\n    setTags(custData.tags || []);\n    setOrders((ordData || []) as OrderWithRelations[]);\n\n    setLoading(false);\n  }, [id, supabase, router]);\n\n  useEffect(() => {\n    if (id) fetchCustomerDetails();\n  }, [id, fetchCustomerDetails]);\n\n  const handleSave = async () => {\n    const { error } = await (supabase as any)\n      .from(\"customers\")\n      .update({ notes, reliability_score: reliability, tags })\n      .eq(\"id\", id);\n\n    if (error) toast.error(\"Failed to save changes\");\n    else toast.success(\"Customer profile updated\");\n  };\n\n  const getStatusColor = (status: string | null) => {\n    switch (status || \"pending\") {\n      case \"delivered\":\n        return \"bg-green-100 text-green-700\";\n      case \"shipped\":\n        return \"bg-blue-100 dark:bg-blue-500/20 text-blue-700\";\n      case \"cancelled\":\n        return \"bg-red-100 dark:bg-red-500/20 text-red-700\";\n      default:\n        return \"bg-orange-100 text-orange-700\";\n    }\n  };\n\n  if (loading)\n    return (\n      <div className=\"h-[80vh] flex items-center justify-center\">\n        <ChickenLoader mode=\"dashboard\" />\n      </div>\n    );\n\n  return (\n    <div className=\"space-y-8 max-w-7xl mx-auto\">\n      <div className=\"flex items-center justify-between\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => router.back()}\n          className=\"rounded-full hover:bg-muted font-bold group\"\n        >\n          <ArrowLeft className=\"me-2 h-4 w-4 group-hover:-translate-x-1 transition-transform\" />{\" \"}\n          ┘é╪º╪ª┘à╪⌐ ╪º┘ä╪▓╪¿╪º╪ª┘å\n        </Button>\n        <div className=\"flex items-center gap-2\">\n          <Badge\n            className={clsx(\n              \"px-4 py-1 rounded-full text-xs font-black uppercase tracking-widest border-none\",\n              reliability >= 90\n                ? \"bg-green-100 text-green-700\"\n                : \"bg-orange-100 text-orange-700\",\n            )}\n          >\n            {reliability >= 90 ? \"Vetted Client\" : \"Watch List\"}\n          </Badge>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"rounded-full border-emerald-200 dark:border-emerald-500/30 text-emerald-600 hover:bg-emerald-50 dark:bg-emerald-500/10 h-9 font-black\"\n            onClick={() => {\n              const phone = customer?.phone?.replace(/\\s/g, \"\");\n              if (phone)\n                window.open(\n                  `https://wa.me/${phone.startsWith(\"0\") ? \"213\" + phone.slice(1) : phone}`,\n                  \"_blank\",\n                );\n            }}\n          >\n            <MessageCircle className=\"w-4 h-4 me-2\" /> ┘ê╪º╪¬╪│╪º╪¿\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        {/* Main Profile Card */}\n        <div className=\"lg:col-span-1 space-y-8\">\n          <Card className=\"border border-border/40 shadow-sm bg-white dark:bg-zinc-950 rounded-xl overflow-hidden group\">\n            <div className=\"h-24 bg-primary relative\">\n              <div className=\"absolute -bottom-12 left-1/2 -translate-x-1/2\">\n                <div className=\"w-24 h-24 bg-white dark:bg-card p-1.5 rounded-xl shadow-xl group-hover:scale-105 transition-transform\">\n                  <div className=\"w-full h-full bg-muted rounded-xl flex items-center justify-center overflow-hidden\">\n                    <Icon\n                      src=\"https://cdn.lordicon.com/bgebyztw.json\"\n                      trigger=\"loop\"\n                      size={64}\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n            <CardContent className=\"pt-16 text-center space-y-6 pb-10\">\n              <div>\n                <h2 className=\"text-3xl font-black tracking-tight\">\n                  {customer?.full_name}\n                </h2>\n                <p className=\"text-muted-foreground font-medium text-sm\">\n                  ID: #{customer?.id.toString().slice(0, 8)}\n                </p>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"bg-muted/40 p-4 rounded-xl\">\n                  <p className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground mb-1\">\n                    Lifetime Value\n                  </p>\n                  <p className=\"text-xl font-black text-green-600\">\n                    {customer?.total_spent?.toLocaleString() || 0}{\" \"}\n                    <span className=\"text-[10px]\">DA</span>\n                  </p>\n                </div>\n                <div className=\"bg-muted/40 p-4 rounded-xl\">\n                  <p className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground mb-1\">\n                    Frequency\n                  </p>\n                  <p className=\"text-xl font-black\">\n                    {customer?.total_orders || 0}{\" \"}\n                    <span className=\"text-[10px]\">Orders</span>\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"space-y-4 text-left px-4\">\n                <div className=\"flex items-center gap-4 group/item\">\n                  <div className=\"w-10 h-10 rounded-xl bg-primary/10 text-primary flex items-center justify-center group-hover/item:scale-110 transition-transform\">\n                    <Phone className=\"h-5 w-5\" />\n                  </div>\n                  <div>\n                    <p className=\"text-[10px] font-bold text-muted-foreground leading-none mb-1\">\n                      DIRECT LINE\n                    </p>\n                    <span className=\"font-black text-sm\">\n                      {customer?.phone || \"UNAVAILABLE\"}\n                    </span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-4 group/item\">\n                  <div className=\"w-10 h-10 rounded-xl bg-orange-100 text-orange-600 flex items-center justify-center group-hover/item:scale-110 transition-transform\">\n                    <MapPin className=\"h-5 w-5\" />\n                  </div>\n                  <div>\n                    <p className=\"text-[10px] font-bold text-muted-foreground leading-none mb-1\">\n                      PRIMARY CLUSTER\n                    </p>\n                    <span className=\"font-black text-sm uppercase\">\n                      {customer?.wilaya}{\" \"}\n                      {customer?.commune ? `/ ${customer.commune}` : \"\"}\n                    </span>\n                  </div>\n                </div>\n\n                <div className=\"pt-4 border-t border-muted/50\">\n                  <p className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground mb-3\">\n                    Customer Tags\n                  </p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {tags.map((tag) => (\n                      <Badge\n                        key={tag}\n                        className=\"bg-muted hover:bg-muted/80 text-muted-foreground border-none rounded-lg px-2 py-1 flex items-center gap-1 group/tag\"\n                      >\n                        {tag}\n                        <X\n                          className=\"w-3 h-3 cursor-pointer opacity-0 group-hover/tag:opacity-100 transition-opacity\"\n                          onClick={() => setTags(tags.filter((t) => t !== tag))}\n                        />\n                      </Badge>\n                    ))}\n                    <div className=\"flex items-center gap-1\">\n                      <Input\n                        placeholder=\"Add...\"\n                        className=\"h-7 w-20 text-[10px] rounded-lg border-dashed bg-transparent p-2\"\n                        value={newTag}\n                        onChange={(e) => setNewTag(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === \"Enter\" && newTag) {\n                            setTags([...tags, newTag]);\n                            setNewTag(\"\");\n                          }\n                        }}\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Admin Context */}\n          <Card className=\"border border-border/40 shadow-sm rounded-xl bg-white dark:bg-zinc-950\">\n            <CardHeader>\n              <CardTitle className=\"text-lg font-black uppercase tracking-widest text-muted-foreground/60\">\n                ╪Ñ╪»╪º╪▒╪⌐ ╪º┘ä┘à╪«╪º╪╖╪▒\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"space-y-3\">\n                <Label className=\"text-xs font-black uppercase tracking-widest ms-1\">\n                  ┘à┘ä╪º╪¡╪╕╪º╪¬ ╪│┘ä┘ê┘â┘è╪⌐\n                </Label>\n                <Textarea\n                  placeholder=\"Describe interactions, preferences or flags...\"\n                  value={notes}\n                  onChange={(e) => setNotes(e.target.value)}\n                  className=\"min-h-[120px] rounded-xl border-transparent bg-background focus:ring-primary/20\"\n                />\n              </div>\n              <div className=\"space-y-3\">\n                <Label className=\"text-xs font-black uppercase tracking-widest ms-1\">\n                  ┘à╪ñ╪┤╪▒ ╪º┘ä┘à┘ê╪½┘ê┘é┘è╪⌐ ({reliability}%)\n                </Label>\n                <div className=\"flex items-center gap-4\">\n                  <Input\n                    type=\"range\"\n                    value={reliability}\n                    onChange={(e) => setReliability(Number(e.target.value))}\n                    max={100}\n                    min={0}\n                    className=\"accent-primary h-2\"\n                  />\n                  <div\n                    className={clsx(\n                      \"w-12 h-12 rounded-xl flex items-center justify-center shrink-0 shadow-lg\",\n                      reliability >= 90\n                        ? \"bg-green-500 text-white\"\n                        : \"bg-orange-500 text-white\",\n                    )}\n                  >\n                    {reliability >= 90 ? (\n                      <ShieldCheck className=\"w-6 h-6\" />\n                    ) : (\n                      <ShieldAlert className=\"w-6 h-6\" />\n                    )}\n                  </div>\n                </div>\n              </div>\n              <Button\n                className=\"w-full h-14 rounded-xl font-black text-lg shadow-sm bg-primary hover:bg-primary/90\"\n                onClick={handleSave}\n              >\n                <Save className=\"me-2 h-5 w-5\" /> ┘à╪▓╪º┘à┘å╪⌐ ╪º┘ä┘à┘ä┘ü ╪º┘ä╪┤╪«╪╡┘è\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Activity Logs (Order History) */}\n        <div className=\"lg:col-span-2\">\n          <Card className=\"h-full border border-border/40 shadow-sm rounded-xl bg-white dark:bg-zinc-950 relative overflow-hidden\">\n            <CardHeader className=\"p-8 pb-4\">\n              <div className=\"flex justify-between items-center\">\n                <CardTitle className=\"text-2xl font-black flex items-center gap-3\">\n                  <div className=\"w-10 h-10 rounded-xl bg-muted flex items-center justify-center\">\n                    <Icon\n                      src=\"https://cdn.lordicon.com/wxnxiano.json\"\n                      trigger=\"loop\"\n                      size={28}\n                    />\n                  </div>\n                  Transaction History\n                </CardTitle>\n                <Badge\n                  variant=\"secondary\"\n                  className=\"font-bold rounded-lg px-3\"\n                >\n                  {orders.length} TOTAL\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"divide-y divide-muted/50\">\n                {orders.map((order) => (\n                  <div\n                    key={order.id}\n                    className=\"p-8 hover:bg-muted/10 transition-all duration-300 flex flex-col md:flex-row md:items-center justify-between gap-6 group\"\n                  >\n                    <div className=\"flex items-center gap-6\">\n                      <div\n                        className={clsx(\n                          \"w-16 h-16 rounded-xl flex items-center justify-center shrink-0 shadow-inner group-hover:scale-110 transition-transform\",\n                          order.category === \"machine\"\n                            ? \"bg-purple-50 text-purple-600\"\n                            : \"bg-orange-50 text-orange-600\",\n                        )}\n                      >\n                        <Icon\n                          src={\n                            order.category === \"eggs\"\n                              ? \"https://cdn.lordicon.com/hursldjj.json\"\n                              : order.category === \"chicks\"\n                                ? \"https://cdn.lordicon.com/rxufjlal.json\"\n                                : \"https://cdn.lordicon.com/msoeawqm.json\"\n                          }\n                          trigger=\"hover\"\n                          size={32}\n                        />\n                      </div>\n                      <div className=\"min-w-0\">\n                        <p className=\"text-xl font-black truncate\">\n                          {order.product_name}\n                        </p>\n                        <div className=\"flex items-center gap-2 mt-1\">\n                          <Badge\n                            variant=\"outline\"\n                            className=\"text-[10px] font-black border-muted-foreground/20 px-1.5 py-0 leading-none h-4 uppercase\"\n                          >\n                            {order.category}\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground font-medium flex items-center gap-1\">\n                            <Clock className=\"w-3 h-3\" />{\" \"}\n                            {order.created_at\n                              ? formatDistanceToNow(\n                                  new Date(order.created_at),\n                                  { addSuffix: true },\n                                )\n                              : \"N/A\"}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center justify-between md:text-right md:flex-col md:items-end gap-2 w-full md:w-auto border-t md:border-none pt-4 md:pt-0\">\n                      <div>\n                        <p className=\"text-2xl font-black tracking-tighter text-green-600\">\n                          {(order.total_amount || 0).toLocaleString()}{\" \"}\n                          <span className=\"text-xs font-bold opacity-60\">\n                            DA\n                          </span>\n                        </p>\n                        <p className=\"text-[10px] font-bold text-muted-foreground leading-none\">\n                          UNIT TYPE: x{order.quantity || 1}\n                        </p>\n                      </div>\n                      <Badge\n                        variant=\"outline\"\n                        className={clsx(\n                          \"mt-1 capitalize rounded-xl px-3 py-0.5 font-bold tracking-widest text-[10px] border-none\",\n                          getStatusColor(order.status),\n                        )}\n                      >\n                        {order.status}\n                      </Badge>\n                    </div>\n                  </div>\n                ))}\n                {orders.length === 0 && (\n                  <div className=\"py-20 text-center space-y-4 opacity-50\">\n                    <Icon\n                      src=\"https://cdn.lordicon.com/msoeawqm.json\"\n                      trigger=\"loop\"\n                      size={80}\n                    />\n                    <p className=\"text-xl font-black\">\n                      STAGNANT TRANSACTION LOG\n                    </p>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\customers\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\customers\\page.tsx:49:5\n  47 |\n  48 |   useEffect(() => {\n> 49 |     fetchCustomers();\n     |     ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  50 |   }, [fetchCustomers]);\n  51 |\n  52 |   const getCustomerTier = (spent: number = 0) => {","line":49,"column":5,"nodeType":null,"endLine":49,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport { useEffect, useState, useCallback } from \"react\";\nimport { createClient } from \"@/utils/supabase/client\";\nimport type { Customer } from \"@/types/orders\";\nimport { Search, MapPin, Phone, MessageSquare } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { toast } from \"sonner\";\nimport Link from \"next/link\";\nimport ChickenLoader from \"@/components/ui/chicken-loader\";\nimport { Icon } from \"@/components/ui/Icon\";\nimport { clsx } from \"clsx\";\nimport { motion } from \"framer-motion\";\n\nexport default function CustomersPage() {\n  const [customers, setCustomers] = useState<Partial<Customer>[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [search, setSearch] = useState(\"\");\n  const [sortBy, setSortBy] = useState<\"spent\" | \"orders\" | \"reliability\">(\n    \"spent\",\n  );\n  const supabase = createClient();\n\n  const fetchCustomers = useCallback(async () => {\n    setLoading(true);\n    const { data, error } = await supabase\n      .from(\"customers\")\n      .select(\n        \"id, full_name, phone, notes, tags, total_spent, total_orders, reliability_score\",\n      )\n      .order(\"total_spent\", { ascending: false });\n\n    if (error) {\n      console.error(\"Error fetching customers:\", error);\n      toast.error(\"Failed to load customers.\");\n      setCustomers((data as unknown as Partial<Customer>[]) || []);\n    }\n    setLoading(false);\n  }, [supabase]);\n\n  useEffect(() => {\n    fetchCustomers();\n  }, [fetchCustomers]);\n\n  const getCustomerTier = (spent: number = 0) => {\n    if (spent >= 500000)\n      return {\n        label: \"╪¿┘ä╪º╪¬┘è┘å┘è\",\n        color: \"bg-indigo-600 text-white shadow-indigo-500/20\",\n        icon: \"≡ƒÆÄ\",\n      };\n    if (spent >= 150000)\n      return {\n        label: \"╪░┘ç╪¿┘è\",\n        color: \"bg-amber-500 text-white shadow-amber-500/20\",\n        icon: \"Γ¡É\",\n      };\n    if (spent >= 50000)\n      return {\n        label: \"┘ü╪╢┘è\",\n        color: \"bg-slate-400 text-white shadow-slate-400/20\",\n        icon: \"≡ƒÑê\",\n      };\n    return {\n      label: \"╪¿╪▒┘ê┘å╪▓┘è\",\n      color: \"bg-orange-600/80 text-white shadow-orange-600/10\",\n      icon: \"≡ƒÑë\",\n    };\n  };\n\n  const getReliabilityLevel = (score: number) => {\n    if (score >= 90)\n      return {\n        label: \"┘à┘ê╪½┘ê┘é\",\n        color: \"text-emerald-600 bg-emerald-100 dark:bg-emerald-500/20\",\n        icon: \"https://cdn.lordicon.com/lomfljuq.json\",\n      };\n    if (score < 70)\n      return {\n        label: \"╪¬╪¡╪░┘è╪▒\",\n        color: \"text-red-600 bg-red-100 dark:bg-red-500/20\",\n        icon: \"https://cdn.lordicon.com/tdrtiskw.json\",\n      };\n    return {\n      label: \"╪╣╪º╪»┘è\",\n      color: \"text-muted-foreground bg-muted\",\n      icon: \"https://cdn.lordicon.com/bgebyztw.json\",\n    };\n  };\n\n  const filteredCustomers = customers\n    .filter(\n      (c) =>\n        c.full_name?.toLowerCase().includes(search.toLowerCase()) ||\n        c.phone?.includes(search) ||\n        c.notes?.toLowerCase().includes(search.toLowerCase()) ||\n        c.tags?.some((t) => t.toLowerCase().includes(search.toLowerCase())),\n    )\n    .sort((a, b) => {\n      if (sortBy === \"spent\")\n        return (b.total_spent || 0) - (a.total_spent || 0);\n      if (sortBy === \"orders\")\n        return (b.total_orders || 0) - (a.total_orders || 0);\n      if (sortBy === \"reliability\")\n        return (b.reliability_score || 0) - (a.reliability_score || 0);\n      return 0;\n    });\n\n  if (loading)\n    return (\n      <div className=\"h-[80vh] flex items-center justify-center\">\n        <ChickenLoader mode=\"dashboard\" />\n      </div>\n    );\n\n  return (\n    <div className=\"space-y-8 max-w-7xl mx-auto\">\n      <div className=\"flex flex-col xl:flex-row xl:items-end justify-between gap-8\">\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-xl bg-emerald-600 text-white flex items-center justify-center shadow-lg shadow-emerald-500/20\">\n              <Icon\n                src=\"https://cdn.lordicon.com/pdsourfn.json\"\n                trigger=\"loop\"\n                size={32}\n              />\n            </div>\n            <h1 className=\"text-4xl font-black tracking-tighter\">\n              ┘é╪º╪╣╪»╪⌐ ╪¿┘è╪º┘å╪º╪¬ ╪º┘ä╪▓╪¿╪º╪ª┘å\n            </h1>\n          </div>\n          <p className=\"text-muted-foreground font-bold text-lg max-w-xl\">\n            ╪Ñ╪»╪º╪▒╪⌐ ╪º┘ä╪╣┘ä╪º┘é╪º╪¬ ┘à╪╣ ╪º┘ä╪╣┘à┘ä╪º╪í ┘ê╪¬╪¬╪¿╪╣ ╪º┘ä┘é┘è┘à ╪º┘ä╪¬╪▒╪º┘â┘à┘è╪⌐ (CLV) ┘ê┘à┘ê╪½┘ê┘é┘è╪⌐\n            ╪º┘ä╪╖┘ä╪¿╪º╪¬.\n          </p>\n        </div>\n\n        <div className=\"flex flex-col sm:flex-row items-center gap-4 w-full xl:w-auto\">\n          <div className=\"flex items-center gap-2 p-1.5 bg-white dark:bg-card rounded-xl shadow-sm border border-border/50 shrink-0\">\n            {([\"spent\", \"orders\", \"reliability\"] as const).map((type) => (\n              <button\n                key={type}\n                onClick={() => setSortBy(type)}\n                className={clsx(\n                  \"px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all\",\n                  sortBy === type\n                    ? \"bg-emerald-600 text-white shadow-lg shadow-emerald-500/20\"\n                    : \"text-muted-foreground hover:bg-muted\",\n                )}\n              >\n                {type === \"spent\"\n                  ? \"╪º┘ä╪ú┘â╪½╪▒ ╪Ñ┘å┘ü╪º┘é╪º┘ï\"\n                  : type === \"orders\"\n                    ? \"╪╣╪»╪» ╪º┘ä╪╖┘ä╪¿╪º╪¬\"\n                    : \"╪º┘ä┘à┘ê╪½┘ê┘é┘è╪⌐\"}\n              </button>\n            ))}\n          </div>\n\n          <div className=\"relative flex-1 sm:w-[400px]\">\n            <Search className=\"absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground opacity-50\" />\n            <Input\n              placeholder=\"╪º╪¿╪¡╪½ ╪¿╪º┘ä╪º╪│┘à╪î ╪º┘ä┘ç╪º╪¬┘ü╪î ╪ú┘ê ╪º┘ä┘ê╪│┘ê┘à...\"\n              className=\"pr-12 h-14 rounded-xl border-none bg-white dark:bg-card shadow-sm focus:ring-emerald-500/10 transition-all font-black\"\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n            />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-12\">\n        {filteredCustomers.map((customer) => {\n          const rel = getReliabilityLevel(customer.reliability_score || 0);\n          const tier = getCustomerTier(customer.total_spent || 0);\n          return (\n            <Link\n              href={`/customers/${customer.id}`}\n              key={customer.id}\n              className=\"block group\"\n            >\n              <Card className=\"h-full border border-border/40 shadow-sm group-hover:shadow-sm transition-all duration-500 rounded-xl overflow-hidden bg-white dark:bg-card cursor-pointer relative\">\n                <div\n                  className={clsx(\n                    \"absolute top-0 right-0 left-0 h-1.5 opacity-30\",\n                    tier.color.split(\" \")[0],\n                  )}\n                />\n\n                <CardHeader className=\"p-7 pb-4\">\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div className=\"h-16 w-16 rounded-xl bg-muted/50 flex items-center justify-center group-hover:scale-110 transition-transform overflow-hidden shadow-inner relative\">\n                      <Icon src={rel.icon} trigger=\"hover\" size={40} />\n                      <div className=\"absolute -top-1 -right-1 w-6 h-6 rounded-full bg-white dark:bg-zinc-900 shadow-sm flex items-center justify-center text-xs\">\n                        {tier.icon}\n                      </div>\n                    </div>\n                    <div className=\"flex flex-col items-end gap-2 text-right\">\n                      <Badge\n                        className={clsx(\n                          \"rounded-xl border-none font-black text-[9px] uppercase tracking-widest px-3 py-1 shadow-md\",\n                          tier.color,\n                        )}\n                      >\n                        ┘ü╪ª╪⌐ {tier.label}\n                      </Badge>\n                      <Badge\n                        className={clsx(\n                          \"rounded-xl border-none font-black text-[9px] uppercase tracking-widest px-3 py-1\",\n                          rel.color,\n                        )}\n                      >\n                        {rel.label}\n                      </Badge>\n                    </div>\n                  </div>\n                  <div className=\"min-w-0\">\n                    <CardTitle className=\"text-2xl font-black truncate group-hover:text-emerald-600 transition-colors tracking-tighter\">\n                      {customer.full_name}\n                    </CardTitle>\n                    <CardDescription className=\"flex items-center gap-1 font-bold text-sm tracking-tight opacity-70 mt-1\">\n                      <Phone className=\"h-3 w-3\" /> {customer.phone}\n                    </CardDescription>\n                  </div>\n                </CardHeader>\n\n                <CardContent className=\"px-7 pb-7\">\n                  <div className=\"space-y-6\">\n                    <div className=\"grid grid-cols-3 gap-3\">\n                      <div className=\"text-center p-3 bg-muted/20 rounded-xl border border-transparent hover:border-emerald-500/10 transition-colors\">\n                        <div className=\"text-xl font-black tracking-tighter\">\n                          {customer.total_orders || 0}\n                        </div>\n                        <div className=\"text-[10px] font-black uppercase text-muted-foreground tracking-widest\">\n                          ╪╖┘ä╪¿┘è╪º╪¬\n                        </div>\n                      </div>\n                      <div className=\"text-center p-3 bg-emerald-50 dark:bg-emerald-500/5 rounded-xl border border-emerald-100 dark:border-emerald-500/10\">\n                        <div className=\"text-[17px] font-black tracking-tighter text-emerald-600 truncate\">\n                          {(customer.total_spent || 0).toLocaleString()}\n                        </div>\n                        <div className=\"text-[10px] font-black uppercase text-emerald-800/50 dark:text-emerald-400/50 tracking-widest\">\n                          LTV\n                        </div>\n                      </div>\n                      <div className=\"text-center p-3 bg-muted/20 rounded-xl border border-transparent hover:border-emerald-500/10 transition-colors\">\n                        <div className=\"text-xl font-black tracking-tighter\">\n                          {customer.reliability_score || 0}%\n                        </div>\n                        <div className=\"text-[10px] font-black uppercase text-muted-foreground tracking-widest\">\n                          ╪½┘é╪⌐\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex flex-wrap gap-1.5\">\n                      {customer.tags?.map((tag) => (\n                        <Badge\n                          key={tag}\n                          variant=\"secondary\"\n                          className=\"px-2 py-0 h-5 text-[9px] font-black border-none bg-muted rounded-md uppercase opacity-80\"\n                        >\n                          #{tag}\n                        </Badge>\n                      ))}\n                      {customer.tags?.length === 0 && (\n                        <span className=\"text-[10px] font-bold text-muted-foreground/30 uppercase tracking-widest\">\n                          ╪¿╪»┘ê┘å ┘ê╪│┘ê┘à\n                        </span>\n                      )}\n                    </div>\n\n                      <div className=\"bg-orange-50 dark:bg-orange-500/5 p-4 rounded-xl text-[12px] text-orange-800 dark:text-orange-200 font-bold border border-orange-100 dark:border-orange-500/10 line-clamp-2 italic leading-relaxed\">\n                        &quot;{customer.notes}&quot;\n                      </div>\n\n                    <div className=\"flex items-center justify-between pt-2\">\n                      <div className=\"h-2 flex-1 bg-muted rounded-full overflow-hidden me-4\">\n                        <motion.div\n                          initial={{ width: 0 }}\n                          animate={{\n                            width: `${customer.reliability_score || 0}%`,\n                          }}\n                          className={clsx(\n                            \"h-full rounded-full\",\n                            (customer.reliability_score || 0) >= 90\n                              ? \"bg-emerald-500\"\n                              : (customer.reliability_score || 0) >= 70\n                                ? \"bg-amber-500\"\n                                : \"bg-red-500\",\n                          )}\n                        />\n                      </div>\n                      <span className=\"text-[10px] font-black text-muted-foreground\">\n                        SCORE\n                      </span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </Link>\n          );\n        })}\n        {filteredCustomers.length === 0 && (\n          <div className=\"col-span-full text-center py-24 bg-muted/10 rounded-xl border-2 border-dashed border-muted\">\n            <div className=\"w-24 h-24 bg-muted/50 rounded-full flex items-center justify-center mx-auto mb-6\">\n              <Icon\n                src=\"https://cdn.lordicon.com/dxjqvkzv.json\"\n                trigger=\"loop\"\n                size={64}\n              />\n            </div>\n            <h3 className=\"text-2xl font-black opacity-30\">\n              ┘ä╪º ╪¬┘ê╪¼╪» ╪¿┘è╪º┘å╪º╪¬ ┘à╪╖╪º╪¿┘é╪⌐\n            </h3>\n            <p className=\"text-muted-foreground font-black mt-2\">\n              ╪¼╪▒╪¿ ╪º┘ä╪¿╪¡╪½ ╪¿┘â┘ä┘à╪º╪¬ ┘à╪«╪¬┘ä┘ü╪⌐ ┘ä┘ä╪╣╪½┘ê╪▒ ╪╣┘ä┘ë ╪º┘ä╪▓╪¿┘ê┘å.\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\inventory\\breeds\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\inventory\\breeds\\page.tsx:132:5\n  130 |\n  131 |   useEffect(() => {\n> 132 |     fetchProducts();\n      |     ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  133 |     fetchMetadata();\n  134 |   }, [fetchProducts, fetchMetadata]);\n  135 |","line":132,"column":5,"nodeType":null,"endLine":132,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport { createClient } from \"@/utils/supabase/client\";\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Plus,\n  Edit,\n  Trash2,\n  Search,\n  Egg,\n  Bird,\n  AlertTriangle,\n  Package,\n  Activity,\n  Loader2,\n} from \"lucide-react\";\nimport { clsx } from \"clsx\";\nimport { toast } from \"sonner\";\nimport ChickenLoader from \"@/components/ui/chicken-loader\";\nimport Link from \"next/link\";\nimport { Icon } from \"@/components/ui/Icon\";\n\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\nimport { Database } from \"@/types/supabase\";\n\ntype Breed = Database[\"public\"][\"Tables\"][\"breeds\"][\"Row\"];\ntype Family = Database[\"public\"][\"Tables\"][\"families\"][\"Row\"];\ntype Product = Database[\"public\"][\"Tables\"][\"products\"][\"Row\"] & {\n  families?: Family | null;\n  breeds?: Breed | null;\n};\n\nexport default function BreedsPage() {\n  const [products, setProducts] = useState<Partial<Product>[]>([]);\n  const [families, setFamilies] = useState<any[]>([]);\n  const [breeds, setBreeds] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isAdding, setIsAdding] = useState(false);\n  const [editingId, setEditingId] = useState<string | null>(null);\n\n  // Confirmation Modal State\n  const [confirmOpen, setConfirmOpen] = useState(false);\n  const [itemToDelete, setItemToDelete] = useState<string | null>(null);\n\n  const supabase = createClient();\n\n  const [formData, setFormData] = useState({\n    name_en: \"\",\n    slug: \"\",\n    category: \"eggs\",\n    subcategory: \"\",\n    family_id: \"\",\n    breed_id: \"\",\n    color_variation_ar: \"\",\n    price: 0,\n    stock: 0,\n    stock_breakdown: { \"1wk\": 0, \"2wk\": 0, \"4wk\": 0 },\n    next_batch_date: \"\",\n    image_url: \"/images/chicken.svg\",\n    description: \"\", // Added description to formData\n  });\n\n  // Auto-generate slug from name\n  const generateSlug = (name: string) => {\n    return name\n      .toLowerCase()\n      .trim()\n      .replace(/[^\\w ]+/g, \"\")\n      .replace(/ +/g, \"-\");\n  };\n\n  const handleNameChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const name = e.target.value;\n    setFormData((prev) => ({\n      ...prev,\n      name_en: name,\n      slug:\n        prev.slug === generateSlug(prev.name_en)\n          ? generateSlug(name)\n          : prev.slug,\n    }));\n  };\n\n  const fetchMetadata = useCallback(async () => {\n    const { data: fams } = await supabase\n      .from(\"families\")\n      .select(\"id, name_en, name_ar\")\n      .order(\"display_order\");\n    const { data: brds } = await supabase\n      .from(\"breeds\")\n      .select(\"id, name_en, name_ar, family_id\")\n      .order(\"name_ar\");\n    if (fams) setFamilies(fams);\n    if (brds) setBreeds(brds);\n  }, [supabase]);\n\n  const fetchProducts = useCallback(async (showLoader = true) => {\n    if (showLoader) setLoading(true);\n    const { data, error } = await supabase\n      .from(\"products\")\n      .select(\n        `\n        id, name_en, category, subcategory, family_id, breed_id, slug, image_url, description, price, stock, stock_breakdown, next_batch_date,\n        families:family_id (name_ar),\n        breeds:breed_id (name_ar)\n      `,\n      )\n      .neq(\"category\", \"machine\")\n      .is(\"deleted_at\", null) // Only active products\n      .order(\"category\", { ascending: true });\n\n    if (error) {\n      console.error(\"Error fetching products:\", JSON.stringify(error, null, 2));\n      toast.error(\"Failed to load inventory: \" + error.message);\n    } else {\n      setProducts((data as unknown as Partial<Product>[]) || []);\n    }\n    if (showLoader) setLoading(false);\n  }, [supabase]);\n\n  useEffect(() => {\n    fetchProducts();\n    fetchMetadata();\n  }, [fetchProducts, fetchMetadata]);\n\n  const handleSave = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    type ProductInsert = Database[\"public\"][\"Tables\"][\"products\"][\"Insert\"];\n    type ProductUpdate = Database[\"public\"][\"Tables\"][\"products\"][\"Update\"];\n\n    const payload: ProductInsert = {\n      name_en: formData.name_en,\n      price: Number(formData.price),\n      stock: Number(formData.stock),\n      breed_id: formData.breed_id || null,\n      family_id: formData.family_id || null,\n      category: formData.category,\n      subcategory: formData.subcategory,\n      image_url: formData.image_url,\n      description: formData.description,\n      slug: formData.slug || formData.name_en.toLowerCase().replace(/ /g, \"-\"),\n      is_active: true,\n      stock_breakdown:\n        formData.category === \"chicks\" ? formData.stock_breakdown : null,\n      next_batch_date:\n        formData.category === \"eggs\" ? formData.next_batch_date : null,\n    };\n\n    if (editingId) {\n      const updatePayload: ProductUpdate = {\n        ...payload,\n        is_active: undefined, // Don't overwrite is_active on update if not needed\n      };\n      const { error } = await supabase\n        .from(\"products\")\n        .update(updatePayload)\n        .eq(\"id\", editingId);\n      if (error) toast.error(\"Update failed\");\n      else {\n        toast.success(\"Product updated!\");\n        resetForm();\n        fetchProducts(false);\n      }\n    } else {\n      const { error } = await supabase.from(\"products\").insert([payload]);\n      if (error) toast.error(\"Creation failed\");\n      else {\n        toast.success(\"Product created!\");\n        resetForm();\n        fetchProducts(false);\n      }\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!itemToDelete) return;\n    const { error } = await supabase\n      .from(\"products\")\n      .update({ deleted_at: new Date().toISOString() })\n      .eq(\"id\", itemToDelete);\n\n    if (error) toast.error(\"Delete failed\");\n    else {\n      toast.success(\"Product moved to recycle bin\");\n      fetchProducts(false);\n    }\n\n    setConfirmOpen(false);\n    setItemToDelete(null);\n  };\n\n  const resetForm = () => {\n    setIsAdding(false);\n    setEditingId(null);\n    setFormData({\n      name_en: \"\",\n      slug: \"\",\n      category: \"eggs\",\n      subcategory: \"\",\n      family_id: \"\",\n      breed_id: \"\",\n      color_variation_ar: \"\",\n      price: 0,\n      stock: 0,\n      stock_breakdown: { \"1wk\": 0, \"2wk\": 0, \"4wk\": 0 },\n      next_batch_date: \"\",\n      image_url: \"/images/chicken.svg\",\n      description: \"\",\n    });\n  };\n\n  const handleEdit = (product: any) => {\n    setEditingId(product.id);\n    setFormData({\n      name_en: product.name_en,\n      slug: product.slug || \"\",\n      category: product.category,\n      subcategory: product.subcategory || \"\",\n      family_id: product.family_id || \"\",\n      breed_id: product.breed_id || \"\",\n      color_variation_ar: product.color_variation_ar || \"\",\n      price: product.price,\n      stock: product.stock,\n      stock_breakdown: product.stock_breakdown || {\n        \"1wk\": 0,\n        \"2wk\": 0,\n        \"4wk\": 0,\n      },\n      next_batch_date: product.next_batch_date || \"\",\n      image_url: product.image_url || \"/images/chicken.svg\",\n      description: product.description || \"\",\n    });\n    setIsAdding(true);\n    window.scrollTo({ top: 0, behavior: \"smooth\" });\n  };\n\n  if (loading)\n    return (\n      <div className=\"h-[80vh] flex items-center justify-center\">\n        <ChickenLoader mode=\"dashboard\" />\n      </div>\n    );\n\n  return (\n    <div className=\"space-y-8 max-w-7xl mx-auto\">\n      <ConfirmDialog\n        isOpen={confirmOpen}\n        onClose={() => {\n          setConfirmOpen(false);\n          setItemToDelete(null);\n        }}\n        onConfirm={handleDelete}\n        title=\"Move to Recycle Bin?\"\n        description=\"Are you sure you want to move this product to the recycle bin? It will be hidden from the storefront.\"\n        confirmText=\"Move to Bin\"\n        variant=\"destructive\"\n      />\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl md:text-4xl font-black tracking-tighter text-foreground\">\n            ┘à╪«╪▓┘ê┘å ╪º┘ä┘à┘ê╪º╪┤┘è\n          </h1>\n          <p className=\"text-sm md:text-base text-muted-foreground\">\n            ╪Ñ╪»╪º╪▒╪⌐ ╪º┘ä╪¿┘è╪╢╪î ╪º┘ä┘â╪¬╪º┘â┘è╪¬╪î ┘ê╪º┘ä╪»┘ê╪º╪¼┘å ┘ü┘è ╪º┘ä┘à╪▓╪▒╪╣╪⌐.\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Link href=\"/products/recycle-bin\">\n            <Button\n              variant=\"outline\"\n              className=\"rounded-xl px-4 border-muted-foreground/20 text-muted-foreground hover:text-red-500 hover:bg-red-50 dark:bg-red-500/10 font-black h-12\"\n            >\n              <Trash2 className=\"ms-2 h-4 w-4\" /> ╪│┘ä╪⌐ ╪º┘ä┘à╪¡╪░┘ê┘ü╪º╪¬\n            </Button>\n          </Link>\n          {!isAdding && (\n            <Button\n              onClick={() => setIsAdding(true)}\n              className=\"rounded-xl px-6 font-black shadow-lg shadow-emerald-500/20 h-12 bg-emerald-600 hover:bg-emerald-700\"\n            >\n              <Plus className=\"ms-2 h-5 w-5\" /> ╪Ñ╪╢╪º┘ü╪⌐ ┘à╪«╪▓┘ê┘å\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {isAdding && (\n        <Card className=\"border border-border/40 shadow-sm bg-white dark:bg-zinc-950 relative overflow-hidden\">\n          <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-green-400 to-emerald-600\" />\n          <CardHeader className=\"p-4 md:p-6 pb-2 md:pb-4\">\n            <CardTitle className=\"text-xl md:text-2xl font-black leading-tight\">\n              {editingId ? \"╪¬╪╣╪»┘è┘ä ╪¿┘è╪º┘å╪º╪¬ ╪º┘ä┘à╪«╪▓┘ê┘å\" : \"╪Ñ╪╢╪º┘ü╪⌐ ┘à╪«╪▓┘ê┘å ╪¼╪»┘è╪» ┘ä┘ä┘à╪▓╪▒╪╣╪⌐\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"pt-6\">\n            <form\n              onSubmit={handleSave}\n              className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\"\n            >\n              <div className=\"space-y-2\">\n                <Label className=\"text-[11px] md:text-xs font-black uppercase tracking-widest text-muted-foreground/80\">\n                  ┘à╪▒╪¡┘ä╪⌐ ╪º┘ä┘å┘à┘ê\n                </Label>\n                <select\n                  className=\"flex h-12 w-full rounded-xl border-transparent bg-muted/50 px-4 py-2 text-sm font-black focus:bg-background focus:ring-2 focus:ring-emerald-500/20 outline-none transition-all\"\n                  value={formData.category}\n                  onChange={(e) =>\n                    setFormData({ ...formData, category: e.target.value })\n                  }\n                >\n                  <option value=\"eggs\">╪¿┘è╪╢ ╪¬┘ü┘é┘è╪│</option>\n                  <option value=\"chicks\">╪╡┘è╪╡╪º┘å</option>\n                  <option value=\"chickens\">╪»┘ê╪º╪¼┘å ╪¿╪º┘ä╪║╪⌐</option>\n                </select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-[11px] md:text-xs font-black uppercase tracking-widest text-muted-foreground/80\">\n                  ╪╡┘å┘ü ╪º┘ä╪╣╪º╪ª┘ä╪⌐\n                </Label>\n                <select\n                  className=\"flex h-12 w-full rounded-xl border-transparent bg-muted/50 px-4 py-2 text-sm font-black focus:bg-background focus:ring-2 focus:ring-emerald-500/20 outline-none transition-all\"\n                  value={formData.family_id}\n                  onChange={(e) => {\n                    const famId = e.target.value;\n                    setFormData({\n                      ...formData,\n                      family_id: famId,\n                      breed_id: \"\",\n                    });\n                  }}\n                >\n                  <option value=\"\">-- ╪º╪«╪¬╪▒ ╪º┘ä╪╣╪º╪ª┘ä╪⌐ --</option>\n                  {families.map((f) => (\n                    <option key={f.id} value={f.id}>\n                      {f.name_ar} ({f.name_en})\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-[11px] md:text-xs font-black uppercase tracking-widest text-muted-foreground/80\">\n                  ╪º┘ä╪│┘ä╪º┘ä╪⌐ ╪º┘ä╪¬┘ü╪╡┘è┘ä┘è╪⌐\n                </Label>\n                <select\n                  className=\"flex h-12 w-full rounded-xl border-transparent bg-muted/50 px-4 py-2 text-sm font-black focus:bg-background focus:ring-2 focus:ring-emerald-500/20 outline-none transition-all\"\n                  value={formData.breed_id}\n                  disabled={!formData.family_id}\n                  onChange={(e) => {\n                    const selectedBreed = breeds.find(\n                      (b) => b.id === e.target.value,\n                    );\n                    if (selectedBreed) {\n                      const typeSuffix =\n                        formData.category === \"eggs\"\n                          ? \"(Eggs)\"\n                          : formData.category === \"chicks\"\n                            ? \"(Chick)\"\n                            : \"(Adult)\";\n                      setFormData({\n                        ...formData,\n                        breed_id: selectedBreed.id,\n                        name_en: `${selectedBreed.name_en} ${typeSuffix}`,\n                        slug: generateSlug(\n                          `${selectedBreed.name_en} ${typeSuffix}`,\n                        ),\n                      });\n                    }\n                  }}\n                >\n                  <option value=\"\">-- ╪º╪«╪¬╪▒ ╪º┘ä╪│┘ä╪º┘ä╪⌐ --</option>\n                  {breeds\n                    .filter(\n                      (b) => String(b.family_id) === String(formData.family_id),\n                    )\n                    .map((b) => (\n                      <option key={b.id} value={b.id}>\n                        {b.name_ar}\n                      </option>\n                    ))}\n                </select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-[11px] md:text-xs font-black uppercase tracking-widest text-muted-foreground/80\">\n                  ╪│╪╣╪▒ ╪º┘ä╪¬╪»╪º┘ê┘ä (╪»╪¼)\n                </Label>\n                <Input\n                  type=\"number\"\n                  value={formData.price}\n                  onChange={(e) =>\n                    setFormData({ ...formData, price: Number(e.target.value) })\n                  }\n                  className=\"bg-muted/50 border-transparent focus:bg-background h-12 rounded-xl font-black\"\n                />\n              </div>\n\n              {formData.category === \"chicks\" ? (\n                <div className=\"col-span-full grid grid-cols-3 gap-4 p-6 bg-muted/20 rounded-xl border border-muted/50\">\n                  <div className=\"col-span-full mb-2 font-black text-sm uppercase tracking-wider text-primary\">\n                    Maturation Matrix\n                  </div>\n                  <div className=\"space-y-1\">\n                    <Label className=\"text-[10px] font-bold tracking-widest opacity-70\">\n                      1 WEEK\n                    </Label>\n                    <Input\n                      type=\"number\"\n                      value={(formData.stock_breakdown as any)?.[\"1wk\"] || 0}\n                      onChange={(e) =>\n                        setFormData({\n                          ...formData,\n                          // Stock breakdown display removed as it's not in the DB schema anymore\n                          stock_breakdown: {\n                            ...(formData.stock_breakdown as any),\n                            \"1wk\": Number(e.target.value),\n                          },\n                          stock:\n                            Number(e.target.value) +\n                            ((formData.stock_breakdown as any)?.[\"2wk\"] || 0) +\n                            ((formData.stock_breakdown as any)?.[\"4wk\"] || 0),\n                        })\n                      }\n                      className=\"bg-background\"\n                    />\n                  </div>\n                  <div className=\"space-y-1\">\n                    <Label className=\"text-[10px] font-bold tracking-widest opacity-70\">\n                      2 WEEKS\n                    </Label>\n                    <Input\n                      type=\"number\"\n                      value={(formData.stock_breakdown as any)?.[\"2wk\"] || 0}\n                      onChange={(e) =>\n                        setFormData({\n                          ...formData,\n                          stock_breakdown: {\n                            ...(formData.stock_breakdown as any),\n                            \"2wk\": Number(e.target.value),\n                          },\n                          stock:\n                            ((formData.stock_breakdown as any)?.[\"1wk\"] || 0) +\n                            Number(e.target.value) +\n                            ((formData.stock_breakdown as any)?.[\"4wk\"] || 0),\n                        })\n                      }\n                      className=\"bg-background\"\n                    />\n                  </div>\n                  <div className=\"space-y-1\">\n                    <Label className=\"text-[10px] font-bold tracking-widest opacity-70\">\n                      4 WEEKS\n                    </Label>\n                    <Input\n                      type=\"number\"\n                      value={(formData.stock_breakdown as any)?.[\"4wk\"] || 0}\n                      onChange={(e) =>\n                        setFormData({\n                          ...formData,\n                          stock_breakdown: {\n                            ...(formData.stock_breakdown as any),\n                            \"4wk\": Number(e.target.value),\n                          },\n                          stock:\n                            ((formData.stock_breakdown as any)?.[\"1wk\"] || 0) +\n                            ((formData.stock_breakdown as any)?.[\"2wk\"] || 0) +\n                            Number(e.target.value),\n                        })\n                      }\n                      className=\"bg-background\"\n                    />\n                  </div>\n                  <div className=\"col-span-full mt-2 text-xs font-bold text-muted-foreground\">\n                    Aggregated Inventory:{\" \"}\n                    <span className=\"text-primary text-lg\">\n                      {formData.stock}\n                    </span>{\" \"}\n                    units\n                  </div>\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[11px] md:text-xs font-bold uppercase tracking-widest text-muted-foreground/80\">\n                    ╪Ñ╪¼┘à╪º┘ä┘è ╪º┘ä┘à╪«╪▓┘ê┘å ╪º┘ä┘à╪¬┘ê┘ü╪▒\n                  </Label>\n                  <Input\n                    type=\"number\"\n                    value={formData.stock}\n                    onChange={(e) =>\n                      setFormData({\n                        ...formData,\n                        stock: Number(e.target.value),\n                      })\n                    }\n                    className=\"bg-muted/50 border-transparent focus:bg-background h-11\"\n                  />\n                </div>\n              )}\n\n              {formData.category === \"eggs\" && (\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[11px] md:text-xs font-bold uppercase tracking-widest text-muted-foreground/80\">\n                    Incubation Maturity Date\n                  </Label>\n                  <Input\n                    type=\"date\"\n                    value={formData.next_batch_date || \"\"}\n                    onChange={(e) =>\n                      setFormData({\n                        ...formData,\n                        next_batch_date: e.target.value,\n                      })\n                    }\n                    className=\"bg-muted/50 border-transparent focus:bg-background h-11\"\n                  />\n                </div>\n              )}\n\n              <div className=\"col-span-full flex justify-end gap-3 pt-6 border-t border-dashed mt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  className=\"rounded-xl px-6 min-h-[48px] font-black\"\n                  onClick={resetForm}\n                >\n                  ╪Ñ┘ä╪║╪º╪í ╪º┘ä╪╣┘à┘ä┘è╪⌐\n                </Button>\n                <Button\n                  disabled={loading}\n                  type=\"submit\"\n                  className=\"rounded-xl px-12 min-h-[48px] font-black shadow-sm shadow-emerald-500/20 bg-emerald-600 hover:bg-emerald-700 text-white\"\n                >\n                  {loading ? (\n                    <Loader2 className=\"w-5 h-5 animate-spin mr-2\" />\n                  ) : null}\n                  {editingId ? \"╪¬╪¡╪»┘è╪½ ╪º┘ä┘à╪«╪▓┘ê┘å\" : \"╪¬╪ú┘â┘è╪» ╪º┘ä╪Ñ╪╢╪º┘ü╪⌐\"}\n                </Button>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-12\">\n        {products.map((product) => (\n          <Card\n            key={product.id}\n            className=\"group border border-border/40 shadow-sm hover:shadow-sm transition-all duration-500 rounded-xl md:rounded-xl overflow-hidden bg-white dark:bg-card\"\n          >\n            <CardHeader className=\"bg-muted/30 p-5 md:p-6\">\n              <div className=\"flex justify-between items-start mb-4\">\n                <div\n                  className={clsx(\n                    \"w-12 h-12 rounded-xl flex items-center justify-center shadow-inner group-hover:scale-110 transition-transform\",\n                    product.category === \"eggs\"\n                      ? \"bg-orange-100 text-orange-600\"\n                      : product.category === \"chicks\"\n                        ? \"bg-yellow-100 text-yellow-600\"\n                        : \"bg-green-100 text-green-600\",\n                  )}\n                >\n                  <Icon\n                    src={\n                      product.category === \"eggs\"\n                        ? \"https://cdn.lordicon.com/hursldjj.json\"\n                        : \"https://cdn.lordicon.com/rxufjlal.json\"\n                    }\n                    trigger=\"hover\"\n                    size={32}\n                  />\n                </div>\n                <div className=\"flex gap-1 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-10 w-10 bg-background/50 backdrop-blur shadow-sm rounded-xl\"\n                    onClick={() => handleEdit(product)}\n                  >\n                    <Edit className=\"h-4 w-4 text-blue-500\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-10 w-10 bg-background/50 backdrop-blur shadow-sm text-red-500 rounded-xl\"\n                    onClick={() => {\n                      setItemToDelete(product.id || \"\");\n                      setConfirmOpen(true);\n                    }}\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n              <Badge\n                variant=\"outline\"\n                className=\"mb-3 capitalize border-emerald-200 dark:border-emerald-500/30 bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 font-black px-3 py-1 rounded-full\"\n              >\n                {product.category === \"eggs\"\n                  ? \"╪¿┘è╪╢\"\n                  : product.category === \"chicks\"\n                    ? \"╪╡┘è╪╡╪º┘å\"\n                    : \"╪»┘ê╪º╪¼┘å\"}\n                {product.families?.name_ar && ` ΓÇó ${product.families.name_ar}`}\n              </Badge>\n              <CardTitle className=\"text-xl md:text-2xl font-black leading-tight group-hover:text-primary transition-colors\">\n                {product.name_en}\n              </CardTitle>\n              <div className=\"flex flex-wrap gap-2 mt-1\">\n                <CardDescription className=\"font-medium text-xs tracking-wide uppercase opacity-70\">\n                  {product.breeds?.name_ar || product.subcategory}\n                </CardDescription>\n                {product.slug && (\n                  <Badge\n                    variant=\"secondary\"\n                    className=\"text-[9px] h-4 rounded px-1 font-mono tracking-tighter opacity-50 bg-black/5\"\n                  >\n                    /{product.slug}\n                  </Badge>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-5 md:p-6\">\n              <div className=\"flex justify-between items-end\">\n                <div>\n                  <div className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground mb-1\">\n                    ╪│╪╣╪▒ ╪º┘ä╪│┘ê┘é\n                  </div>\n                  <div className=\"text-3xl font-black tracking-tighter\">\n                    {(product.price ?? 0).toLocaleString()}{\" \"}\n                    <span className=\"text-xs opacity-60\">╪»╪¼</span>\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground mb-1\">\n                    ┘à╪│╪¬┘ê┘ë ╪º┘ä┘à╪«╪▓┘ê┘å\n                  </div>\n                  <div\n                    className={clsx(\n                      \"text-2xl font-black px-4 py-1.5 rounded-xl inline-block shadow-sm\",\n                      (product.stock || 0) < 10\n                        ? \"bg-red-50 dark:bg-red-500/10 text-red-600 border border-red-100\"\n                        : \"bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 border border-emerald-100 dark:border-emerald-500/20\",\n                    )}\n                  >\n                    {product.stock || 0}\n                  </div>\n                </div>\n              </div>\n\n              {product.category === \"chicks\" && product.stock_breakdown && (\n                <div className=\"mt-6 pt-4 border-t border-dashed flex justify-between gap-2 overflow-x-auto\">\n                  {Object.entries(\n                    product.stock_breakdown as Record<string, number>,\n                  ).map(([age, count]) => (\n                    <div\n                      key={age}\n                      className=\"text-center px-3 py-2 bg-muted/40 rounded-xl min-w-[70px]\"\n                    >\n                      <div className=\"text-[10px] font-bold opacity-50 mb-1\">\n                        {age.toUpperCase()}\n                      </div>\n                      <div className=\"text-sm font-black\">{count}</div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n        {products.length === 0 && !loading && (\n          <div className=\"col-span-full text-center py-24 bg-muted/20 rounded-xl border-2 border-dashed border-muted\">\n            <Package className=\"h-16 w-16 mx-auto mb-4 opacity-10\" />\n            <h3 className=\"text-2xl font-black opacity-30\">\n              Biological Inventory Empty\n            </h3>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\inventory\\incubators\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\inventory\\incubators\\page.tsx:102:5\n  100 |\n  101 |   useEffect(() => {\n> 102 |     fetchProducts();\n      |     ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  103 |   }, [fetchProducts]);\n  104 |\n  105 |   const handleSave = async (e: React.FormEvent) => {","line":102,"column":5,"nodeType":null,"endLine":102,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport { createClient } from \"@/utils/supabase/client\";\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  CardTitle,\n  CardDescription,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Plus,\n  Edit,\n  Trash2,\n  Search,\n  Thermometer,\n  Settings,\n  Package,\n  Activity,\n  Loader2,\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport ChickenLoader from \"@/components/ui/chicken-loader\";\nimport { AnimatedButton } from \"@/components/ui/AnimatedButton\";\nimport Link from \"next/link\";\nimport { clsx } from \"clsx\";\nimport { Icon } from \"@/components/ui/Icon\";\n\nimport { Database } from \"@/types/supabase\";\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\n\ntype Product = Database[\"public\"][\"Tables\"][\"products\"][\"Row\"];\n\nexport default function IncubatorsPage() {\n  const [products, setProducts] = useState<Product[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isAdding, setIsAdding] = useState(false);\n  const [editingId, setEditingId] = useState<string | null>(null);\n\n  // Confirmation Modal State\n  const [confirmOpen, setConfirmOpen] = useState(false);\n  const [itemToDelete, setItemToDelete] = useState<string | null>(null);\n\n  const supabase = createClient();\n\n  const [formData, setFormData] = useState({\n    name_en: \"\",\n    slug: \"\",\n    category: \"machine\",\n    subcategory: \"Incubator\",\n    price: 0,\n    stock: 0,\n    image_url: \"/images/incubator.svg\",\n  });\n\n  // Auto-generate slug from name\n  const generateSlug = (name: string) => {\n    return name\n      .toLowerCase()\n      .trim()\n      .replace(/[^\\w ]+/g, \"\")\n      .replace(/ +/g, \"-\");\n  };\n\n  const handleNameChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const name = e.target.value;\n    setFormData((prev) => ({\n      ...prev,\n      name_en: name,\n      slug:\n        prev.slug === generateSlug(prev.name_en)\n          ? generateSlug(name)\n          : prev.slug,\n    }));\n  };\n\n  const fetchProducts = useCallback(async (showLoader = true) => {\n    if (showLoader) setLoading(true);\n    const { data, error } = await supabase\n      .from(\"products\")\n      .select(\n        \"id, name_en, slug, category, subcategory, price, stock, image_url\",\n      )\n      .in(\"category\", [\"machine\", \"incubators\"])\n      .is(\"deleted_at\", null) // Only active machines\n      .order(\"price\", { ascending: true });\n\n    if (error) {\n      console.error(\"Error fetching incubators:\", error);\n      toast.error(\"Failed to load inventory.\");\n    } else {\n      setProducts((data as unknown as Product[]) || []);\n    }\n    if (showLoader) setLoading(false);\n  }, [supabase]);\n\n  useEffect(() => {\n    fetchProducts();\n  }, [fetchProducts]);\n\n  const handleSave = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    type ProductInsert = Database[\"public\"][\"Tables\"][\"products\"][\"Insert\"];\n    type ProductUpdate = Database[\"public\"][\"Tables\"][\"products\"][\"Update\"];\n\n    const payload: ProductInsert = {\n      name_en: formData.name_en,\n      price: Number(formData.price),\n      stock: Number(formData.stock),\n      category: formData.category,\n      subcategory: formData.subcategory,\n      image_url: formData.image_url,\n      slug: formData.slug || formData.name_en.toLowerCase().replace(/ /g, \"-\"),\n      is_active: true,\n    };\n\n    if (editingId) {\n      const { error } = await supabase\n        .from(\"products\")\n        .update(payload as ProductUpdate)\n        .eq(\"id\", editingId);\n      if (error) toast.error(\"Update failed\");\n      else {\n        toast.success(\"Product updated!\");\n        resetForm();\n        fetchProducts(false);\n      }\n    } else {\n      // For new products, also set is_active\n      const { error } = await supabase.from(\"products\").insert([payload]);\n      if (error) toast.error(\"Creation failed\");\n      else {\n        toast.success(\"Product created!\");\n        resetForm();\n        fetchProducts(false);\n      }\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!itemToDelete) return;\n    const { error } = await supabase\n      .from(\"products\")\n      .update({ deleted_at: new Date().toISOString() })\n      .eq(\"id\", itemToDelete);\n\n    if (error) toast.error(\"Delete failed\");\n    else {\n      toast.success(\"Asset moved to recycle bin\");\n      fetchProducts(false);\n    }\n\n    setConfirmOpen(false);\n    setItemToDelete(null);\n  };\n\n  const resetForm = () => {\n    setIsAdding(false);\n    setEditingId(null);\n    setFormData({\n      name_en: \"\",\n      slug: \"\",\n      category: \"machine\",\n      subcategory: \"Incubator\",\n      price: 0,\n      stock: 0,\n      image_url: \"/images/incubator.svg\",\n    });\n  };\n\n  const handleEdit = (product: any) => {\n    setEditingId(product.id);\n    setFormData({\n      name_en: product.name_en,\n      slug: product.slug || \"\",\n      category: product.category,\n      subcategory: product.subcategory || \"Incubator\",\n      price: product.price,\n      stock: product.stock,\n      image_url: product.image_url || \"/images/incubator.svg\",\n    });\n    setIsAdding(true);\n    window.scrollTo({ top: 0, behavior: \"smooth\" });\n  };\n\n  if (loading)\n    return (\n      <div className=\"h-[80vh] flex items-center justify-center\">\n        <ChickenLoader mode=\"dashboard\" />\n      </div>\n    );\n\n  return (\n    <div className=\"space-y-10 max-w-7xl mx-auto pb-10\">\n      <ConfirmDialog\n        isOpen={confirmOpen}\n        onClose={() => {\n          setConfirmOpen(false);\n          setItemToDelete(null);\n        }}\n        onConfirm={handleDelete}\n        title=\"Move to Recycle Bin?\"\n        description=\"Are you sure you want to move this asset to the recycle bin? It will be hidden from the storefront.\"\n        confirmText=\"Move to Bin\"\n        variant=\"destructive\"\n      />\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\n        <div>\n          <h1 className=\"text-4xl font-black tracking-tighter flex items-center gap-4\">\n            ┘ê╪¡╪»╪º╪¬ ╪º┘ä╪¡╪º╪╢┘å╪º╪¬{\" \"}\n            <span className=\"text-emerald-200 text-2xl font-black\">/</span>{\" \"}\n            {products.length}\n          </h1>\n          <p className=\"text-muted-foreground font-black\">\n            ┘à╪▒╪º┘é╪¿╪⌐ ╪¡╪º┘ä╪⌐ ╪º┘å╪¬╪┤╪º╪▒ ╪º┘ä╪ó┘ä╪º╪¬ ┘ê╪¬┘ê┘ü╪▒┘ç╪º.\n          </p>\n        </div>\n        {!isAdding && (\n          <AnimatedButton\n            onClick={() => setIsAdding(true)}\n            className=\"h-14 px-10 rounded-xl font-black text-lg shadow-sm shadow-emerald-500/20 bg-emerald-600 hover:bg-emerald-700 text-white border-none\"\n          >\n            <Plus className=\"ms-3 h-6 w-6\" /> ╪Ñ╪╢╪º┘ü╪⌐ ╪¡╪º╪╢┘å╪⌐\n          </AnimatedButton>\n        )}\n      </div>\n\n      {isAdding && (\n        <Card className=\"border border-border/40 shadow-sm rounded-xl bg-white dark:bg-card overflow-hidden animate-in zoom-in-95 duration-300\">\n          <CardHeader className=\"p-8 pb-4\">\n            <CardTitle className=\"text-2xl font-black flex items-center gap-3\">\n              <div className=\"w-10 h-10 rounded-xl bg-emerald-600 text-white flex items-center justify-center shadow-lg shadow-emerald-500/20\">\n                <Plus className=\"w-6 h-6\" />\n              </div>\n              {editingId ? \"╪¬╪╣╪»┘è┘ä ┘à╪╡┘ü┘ê┘ü╪⌐ ╪º┘ä┘ê╪¡╪»╪⌐\" : \"╪¬┘ç┘è╪ª╪⌐ ╪ú╪╡┘ä ╪¼╪»┘è╪»\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-8 pt-0\">\n            <form\n              onSubmit={handleSave}\n              className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\"\n            >\n              <div className=\"space-y-2 lg:col-span-1\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ╪¬╪│┘à┘è╪⌐ ╪º┘ä╪ú╪╡┘ä\n                </Label>\n                <Input\n                  required\n                  value={formData.name_en}\n                  onChange={handleNameChange}\n                  placeholder=\"┘à╪½╪º┘ä: ╪¡╪º╪╢┘å╪⌐ ╪ú┘ê╪¬┘ê┘à╪º╪¬┘è┘â┘è╪⌐ 48 ╪¿┘è╪╢╪⌐\"\n                  className=\"h-12 rounded-xl bg-muted/50 border-none focus:ring-emerald-500/20 font-black\"\n                />\n              </div>\n              <div className=\"space-y-2 lg:col-span-1\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ┘à╪╣╪▒┘ü ╪º┘ä╪▒╪º╪¿╪╖ (Slug)\n                </Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    required\n                    value={formData.slug}\n                    onChange={(e) =>\n                      setFormData({ ...formData, slug: e.target.value })\n                    }\n                    placeholder=\"┘à╪½╪º┘ä: industrial-automatic-48\"\n                    dir=\"ltr\"\n                    className=\"h-12 rounded-xl bg-muted/50 border-none focus:ring-emerald-500/20 font-mono text-xs\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"icon\"\n                    className=\"h-12 w-12 shrink-0 rounded-xl\"\n                    onClick={() =>\n                      setFormData({\n                        ...formData,\n                        slug: generateSlug(formData.name_en),\n                      })\n                    }\n                    title=\"╪¬┘ê┘ä┘è╪» ╪¬┘ä┘é╪º╪ª┘è\"\n                  >\n                    <Activity className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ┘å┘ê╪╣ ╪º┘ä┘â╪¬┘ä╪⌐\n                </Label>\n                <Input\n                  value={formData.subcategory}\n                  onChange={(e) =>\n                    setFormData({ ...formData, subcategory: e.target.value })\n                  }\n                  className=\"h-12 rounded-xl bg-muted/50 border-none focus:ring-emerald-500/20 font-black\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ╪º┘ä┘é┘è┘à╪⌐ ╪º┘ä╪│┘ê┘é┘è╪⌐ (╪»╪¼)\n                </Label>\n                <Input\n                  type=\"number\"\n                  value={formData.price}\n                  onChange={(e) =>\n                    setFormData({ ...formData, price: Number(e.target.value) })\n                  }\n                  className=\"h-12 rounded-xl bg-muted/50 border-none focus:ring-emerald-500/20 font-black\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ╪º┘ä┘ê╪¡╪»╪º╪¬ ╪º┘ä┘à╪¬┘ê┘ü╪▒╪⌐\n                </Label>\n                <Input\n                  type=\"number\"\n                  value={formData.stock}\n                  onChange={(e) =>\n                    setFormData({ ...formData, stock: Number(e.target.value) })\n                  }\n                  className=\"h-12 rounded-xl bg-muted/50 border-none focus:ring-emerald-500/20 font-black\"\n                />\n              </div>\n\n              <div className=\"lg:col-span-4 flex justify-end gap-3 pt-6 border-t border-muted/50 mt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  onClick={resetForm}\n                  className=\"min-h-[48px] h-12 rounded-xl font-black\"\n                >\n                  ╪Ñ┘ä╪║╪º╪í ╪º┘ä╪╣┘à┘ä┘è╪⌐\n                </Button>\n                <Button\n                  disabled={loading}\n                  type=\"submit\"\n                  className=\"min-h-[48px] h-12 px-10 rounded-xl font-black bg-emerald-600 text-white shadow-lg shadow-emerald-500/20 border-none\"\n                >\n                  {loading ? (\n                    <Loader2 className=\"w-5 h-5 animate-spin mr-2\" />\n                  ) : null}\n                  {editingId ? \"╪¬╪¡╪»┘è╪½ ╪º┘ä╪¿┘è╪º┘å╪º╪¬\" : \"╪¬╪ú┘â┘è╪» ╪º┘ä╪¡┘ü╪╕\"}\n                </Button>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n        {products.map((product) => (\n          <Card\n            key={product.id}\n            className=\"relative overflow-hidden group border border-border/40 shadow-sm rounded-xl bg-white dark:bg-card hover:shadow-sm transition-all duration-500\"\n          >\n            <CardHeader className=\"p-7 pb-2 relative z-10\">\n              <div className=\"flex justify-between items-start\">\n                <Badge\n                  variant=\"secondary\"\n                  className=\"capitalize rounded-full px-4 py-1.5 font-black text-[10px] tracking-widest bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 border-none\"\n                >\n                  {product.subcategory === \"Incubator\"\n                    ? \"╪¡╪º╪╢┘å╪⌐\"\n                    : product.subcategory}\n                </Badge>\n                <div className=\"opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-all flex gap-1 translate-y-0 md:translate-y-2 md:group-hover:translate-y-0\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-10 w-10 rounded-xl bg-muted/50 hover:bg-emerald-100 dark:bg-emerald-500/20 text-emerald-600\"\n                    onClick={() => handleEdit(product)}\n                  >\n                    <Edit className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-10 w-10 rounded-xl bg-red-50 dark:bg-red-500/10 hover:bg-red-100 dark:bg-red-500/20 text-red-500\"\n                    onClick={() => {\n                      setItemToDelete(product.id);\n                      setConfirmOpen(true);\n                    }}\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n              <CardTitle className=\"text-2xl font-black leading-tight mt-4 tracking-tight group-hover:text-primary transition-colors flex flex-col gap-1\">\n                {product.name_en}\n                {product.slug && (\n                  <span className=\"text-[10px] font-mono opacity-30\">\n                    /{product.slug}\n                  </span>\n                )}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-7 pt-2 relative z-10\">\n              <div className=\"flex justify-between items-end mt-6\">\n                <div>\n                  <p className=\"text-[10px] font-black uppercase text-muted-foreground tracking-widest mb-1 opacity-50\">\n                    ┘é┘è┘à╪⌐ ╪º┘ä┘ê╪¡╪»╪⌐\n                  </p>\n                  <div className=\"text-3xl font-black tracking-tighter\">\n                    {(product.price ?? 0).toLocaleString()}{\" \"}\n                    <span className=\"text-xs opacity-60\">╪»╪¼</span>\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground mb-1\">\n                    Stock Level\n                  </div>\n                  <div\n                    className={clsx(\n                      \"text-2xl font-black px-4 py-1.5 rounded-xl inline-block shadow-sm\",\n                      (product.stock ?? 0) < 5\n                        ? \"bg-red-50 dark:bg-red-500/10 text-red-600 border border-red-100\"\n                        : \"bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 border border-emerald-100 dark:border-emerald-500/20\",\n                    )}\n                  >\n                    {product.stock ?? 0}\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n            <div className=\"absolute top-0 right-0 w-32 h-32 bg-primary/5 rounded-bl-[5rem] -mr-8 -mt-8 group-hover:bg-primary/10 transition-colors flex items-center justify-center p-8\">\n              <div className=\"opacity-30 group-hover:scale-110 transition-transform -mr-4 -mt-4\">\n                <Icon\n                  src=\"https://cdn.lordicon.com/msoeawqm.json\"\n                  trigger=\"loop\"\n                  size={80}\n                />\n              </div>\n            </div>\n          </Card>\n        ))}\n        {products.length === 0 && !loading && (\n          <div className=\"col-span-full text-center py-24 opacity-20 space-y-4\">\n            <Icon\n              src=\"https://cdn.lordicon.com/dxjqvkzv.json\"\n              trigger=\"loop\"\n              size={80}\n            />\n            <h3 className=\"text-2xl font-black font-mono\">\n              NO ASSETS DETECTED\n            </h3>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\page.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\page.tsx:205:42\n  203 |       o.status === \"pending\" &&\n  204 |       o.created_at &&\n> 205 |       new Date(o.created_at).getTime() < Date.now() - 86400000,\n      |                                          ^^^^^^^^^^ Cannot call impure function\n  206 |   ).length;\n  207 |\n  208 |   if (pendingLong > 0) {","line":205,"column":42,"nodeType":null,"endLine":205,"endColumn":52}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from \"@/utils/supabase/server\";\nimport { subDays, format } from \"date-fns\";\nimport DashboardContent, {\n  type DashboardStats,\n  type Alert,\n  type Forecast,\n  type AnalyticsData,\n} from \"@/components/dashboard/DashboardContent\";\nimport type { Database } from \"@/types/supabase\";\n\nexport const dynamic = \"force-dynamic\";\n\ntype Order = Database[\"public\"][\"Tables\"][\"orders\"][\"Row\"];\ntype Product = Database[\"public\"][\"Tables\"][\"products\"][\"Row\"];\n\nexport default async function DashboardPage() {\n  const supabase = await createClient();\n\n  const [ordersRes, productsRes, customersRes] = await Promise.all([\n    supabase\n      .from(\"orders\")\n      .select(\n        \"id, status, total_amount, created_at, customer_id, product_name, category, wilaya_address\",\n      )\n      .order(\"created_at\", { ascending: false })\n      .limit(200),\n    supabase\n      .from(\"products\")\n      .select(\"id, name, name_en, stock\")\n      .is(\"deleted_at\", null),\n    supabase.from(\"customers\").select(\"id\", { count: \"exact\", head: true }),\n  ]);\n\n  const orders = (ordersRes.data || []) as Order[];\n  const products = (productsRes.data || []) as Product[];\n  const totalCustomers = customersRes.count || 0;\n\n  // 2. Process Analytics on the Server\n  const revenue = orders\n    .filter((o) => o.status !== \"cancelled\")\n    .reduce((sum, o) => sum + (Number(o.total_amount) || 0), 0);\n\n  const activeOrders = orders.filter((o) =>\n    [\"pending\", \"shipped\"].includes(o.status || \"\"),\n  ).length;\n\n  const lowStockThreshold = 10;\n  const lowStockItems = products.filter(\n    (p) => (Number(p.stock) || 0) <= lowStockThreshold,\n  );\n\n  const sevenDaysAgo = subDays(new Date(), 7);\n  const fourteenDaysAgo = subDays(new Date(), 14);\n  const recentOrders = orders.filter(\n    (o) => o.created_at && new Date(o.created_at) > sevenDaysAgo,\n  );\n  const prevPeriodOrders = orders.filter(\n    (o) =>\n      o.created_at &&\n      new Date(o.created_at) > fourteenDaysAgo &&\n      new Date(o.created_at) <= sevenDaysAgo,\n  );\n  const uniqueCustomers = new Set(\n    recentOrders.map((o) => o.customer_id).filter(Boolean),\n  );\n\n  // Revenue Trends (Last 7 Days)\n  const groupedRevenue = new Map<string, number>();\n  const productSales = new Map<string, number>();\n\n  for (let i = 6; i >= 0; i--) {\n    groupedRevenue.set(format(subDays(new Date(), i), \"MMM dd\"), 0);\n  }\n\n  orders\n    .filter((o) => o.status !== \"cancelled\")\n    .forEach((o) => {\n      if (!o.created_at) return;\n      const dateStr = format(new Date(o.created_at), \"MMM dd\");\n      if (groupedRevenue.has(dateStr)) {\n        groupedRevenue.set(\n          dateStr,\n          (groupedRevenue.get(dateStr) || 0) + (Number(o.total_amount) || 0),\n        );\n      }\n\n      const pName = o.product_name || \"Generic Product\";\n      productSales.set(pName, (productSales.get(pName) || 0) + 1);\n    });\n\n  const revenueData = Array.from(groupedRevenue.entries()).map(\n    ([name, revenue]) => ({ name, revenue }),\n  );\n  const topProducts = Array.from(productSales.entries())\n    .map(([name, sales]) => ({ name, sales }))\n    .sort((a, b) => b.sales - a.sales)\n    .slice(0, 5);\n\n  // Category Breakdown\n  const categoryRevenue = new Map<string, number>();\n  orders\n    .filter((o) => o.status !== \"cancelled\")\n    .forEach((o) => {\n      const cat = o.category || \"livestock\";\n      categoryRevenue.set(\n        cat,\n        (categoryRevenue.get(cat) || 0) + (Number(o.total_amount) || 0),\n      );\n    });\n  const categoryData = Array.from(categoryRevenue.entries()).map(\n    ([name, value]) => ({ name, value }),\n  );\n\n  // Wilaya distribution ΓÇö map Arabic name ΓåÆ numeric code using lookup table\n  const WILAYA_NAME_TO_ID: Record<string, string> = {\n    ╪ú╪»╪▒╪º╪▒: \"01\",\n    ╪º┘ä╪┤┘ä┘ü: \"02\",\n    ╪º┘ä╪ú╪║┘ê╪º╪╖: \"03\",\n    \"╪ú┘à ╪º┘ä╪¿┘ê╪º┘é┘è\": \"04\",\n    ╪¿╪º╪¬┘å╪⌐: \"05\",\n    ╪¿╪¼╪º┘è╪⌐: \"06\",\n    ╪¿╪│┘â╪▒╪⌐: \"07\",\n    ╪¿╪┤╪º╪▒: \"08\",\n    ╪º┘ä╪¿┘ä┘è╪»╪⌐: \"09\",\n    ╪º┘ä╪¿┘ê┘è╪▒╪⌐: \"10\",\n    ╪¬┘à┘å╪▒╪º╪│╪¬: \"11\",\n    ╪¬╪¿╪│╪⌐: \"12\",\n    ╪¬┘ä┘à╪│╪º┘å: \"13\",\n    ╪¬┘è╪º╪▒╪¬: \"14\",\n    \"╪¬┘è╪▓┘è ┘ê╪▓┘ê\": \"15\",\n    ╪º┘ä╪¼╪▓╪º╪ª╪▒: \"16\",\n    ╪º┘ä╪¼┘ä┘ü╪⌐: \"17\",\n    ╪¼┘è╪¼┘ä: \"18\",\n    ╪│╪╖┘è┘ü: \"19\",\n    ╪│╪╣┘è╪»╪⌐: \"20\",\n    ╪│┘â┘è┘â╪»╪⌐: \"21\",\n    \"╪│┘è╪»┘è ╪¿┘ä╪╣╪¿╪º╪│\": \"22\",\n    ╪╣┘å╪º╪¿╪⌐: \"23\",\n    ┘é╪º┘ä┘à╪⌐: \"24\",\n    ┘é╪│┘å╪╖┘è┘å╪⌐: \"25\",\n    ╪º┘ä┘à╪»┘è╪⌐: \"26\",\n    ┘à╪│╪¬╪║╪º┘å┘à: \"27\",\n    ╪º┘ä┘à╪│┘è┘ä╪⌐: \"28\",\n    ┘à╪╣╪│┘â╪▒: \"29\",\n    ┘ê╪▒┘é┘ä╪⌐: \"30\",\n    ┘ê┘ç╪▒╪º┘å: \"31\",\n    ╪º┘ä╪¿┘è╪╢: \"32\",\n    ╪Ñ┘ä┘è╪▓┘è: \"33\",\n    \"╪¿╪▒╪¼ ╪¿┘ê╪╣╪▒┘è╪▒┘è╪¼\": \"34\",\n    ╪¿┘ê┘à╪▒╪»╪º╪│: \"35\",\n    ╪º┘ä╪╖╪º╪▒┘ü: \"36\",\n    ╪¬┘å╪»┘ê┘ü: \"37\",\n    ╪¬┘è╪│┘à╪│┘è┘ä╪¬: \"38\",\n    ╪º┘ä┘ê╪º╪»┘è: \"39\",\n    ╪«┘å╪┤┘ä╪⌐: \"40\",\n    \"╪│┘ê┘é ╪ú┘ç╪▒╪º╪│\": \"41\",\n    ╪¬┘è╪¿╪º╪▓╪⌐: \"42\",\n    ┘à┘è┘ä╪⌐: \"43\",\n    \"╪╣┘è┘å ╪º┘ä╪»┘ü┘ä┘ë\": \"44\",\n    ╪º┘ä┘å╪╣╪º┘à╪⌐: \"45\",\n    \"╪╣┘è┘å ╪¬┘à┘ê╪┤┘å╪¬\": \"46\",\n    ╪║╪▒╪»╪º┘è╪⌐: \"47\",\n    ╪║┘ä┘è╪▓╪º┘å: \"48\",\n    ╪¬┘è┘à┘è┘à┘ê┘å: \"49\",\n    \"╪¿╪▒╪¼ ╪¿╪º╪¼┘è ┘à╪«╪¬╪º╪▒\": \"50\",\n    \"╪ú┘ê┘ä╪º╪» ╪¼┘ä╪º┘ä\": \"51\",\n    \"╪¿┘å┘è ╪╣╪¿╪º╪│\": \"52\",\n    \"╪╣┘è┘å ╪╡╪º┘ä╪¡\": \"53\",\n    \"╪╣┘è┘å ┘é╪▓╪º┘à\": \"54\",\n    ╪¬┘é╪▒╪¬: \"55\",\n    ╪¼╪º┘å╪¬: \"56\",\n    ╪º┘ä┘à╪║┘è╪▒: \"57\",\n    ╪º┘ä┘à┘å┘è╪╣╪⌐: \"58\",\n  };\n  const wilayaStats: Record<string, number> = {};\n  orders.forEach((o) => {\n    // wilaya_address stores \"detailedAddress, wilayaName\"\n    // o.wilaya_address comes from place_order: p_address + ', ' + p_wilaya\n    // Try to extract wilaya name from the end of wilaya_address\n    const rawWilaya = o.wilaya_address?.split(\",\").pop()?.trim() || \"\";\n    const wId = WILAYA_NAME_TO_ID[rawWilaya] || \"16\";\n    wilayaStats[wId] = (wilayaStats[wId] || 0) + 1;\n  });\n\n  // Alerts\n  const alerts: Alert[] = [];\n  if (lowStockItems.length > 0) {\n    // Choose \"┘à┘å╪¬╪¼╪º╪¬\" for 3-10, and \"┘à┘å╪¬╪¼╪º┘ï\" for 11-99\n    const itemName =\n      lowStockItems.length > 2 && lowStockItems.length <= 10\n        ? \"┘à┘å╪¬╪¼╪º╪¬\"\n        : \"┘à┘å╪¬╪¼╪º┘ï\";\n    alerts.push({\n      type: \"critical\",\n      message: `┘è┘ê╪¼╪» ${lowStockItems.length} ${itemName} ╪¿┘à╪«╪▓┘ê┘å ┘à┘å╪«┘ü╪╢`,\n      link: \"/inventory/breeds\",\n      label: \"┘å┘é╪╡ ╪º┘ä┘à╪«╪▓┘ê┘å\",\n    });\n  }\n\n  const pendingLong = orders.filter(\n    (o) =>\n      o.status === \"pending\" &&\n      o.created_at &&\n      new Date(o.created_at).getTime() < Date.now() - 86400000,\n  ).length;\n\n  if (pendingLong > 0) {\n    alerts.push({\n      type: \"warning\",\n      message: `${pendingLong} ╪╖┘ä╪¿ ┘à╪¬╪ú╪«╪▒ ┘è╪¡╪¬╪º╪¼ ┘ä┘ä┘à╪╣╪º┘ä╪¼╪⌐`,\n      link: \"/orders\",\n      label: \"╪╖┘ä╪¿┘è╪º╪¬ ┘à╪¬╪ú╪«╪▒╪⌐\",\n    });\n  }\n\n  // Forecasts\n  const forecasts: Forecast[] = [];\n  products.forEach((p) => {\n    const productOrdersCount = orders.filter(\n      (o) =>\n        (o.product_name === p.name_en || o.product_name === p.name) &&\n        o.created_at &&\n        new Date(o.created_at) > sevenDaysAgo,\n    ).length;\n    const dailyRate = productOrdersCount / 7;\n    if (dailyRate > 0) {\n      const daysLeft = Math.floor((p.stock || 0) / dailyRate);\n      if (daysLeft < 7) {\n        forecasts.push({\n          name: p.name_en || p.name || \"Unknown\",\n          daysLeft,\n          stock: p.stock,\n        });\n      }\n    }\n  });\n\n  const avgOrderValue =\n    orders.length > 0\n      ? Math.round(\n          revenue / orders.filter((o) => o.status !== \"cancelled\").length,\n        )\n      : 0;\n  const topBreedName = topProducts.length > 0 ? topProducts[0].name : \"N/A\";\n\n  // Compute real revenue & order change percentages (last 7d vs prior 7d)\n  const recentRevenue = recentOrders\n    .filter((o) => o.status !== \"cancelled\")\n    .reduce((sum, o) => sum + (Number(o.total_amount) || 0), 0);\n  const prevRevenue = prevPeriodOrders\n    .filter((o) => o.status !== \"cancelled\")\n    .reduce((sum, o) => sum + (Number(o.total_amount) || 0), 0);\n  const revenueChange =\n    prevRevenue > 0\n      ? Math.round(((recentRevenue - prevRevenue) / prevRevenue) * 100)\n      : recentRevenue > 0\n        ? 100\n        : 0;\n  const ordersChange =\n    prevPeriodOrders.length > 0\n      ? Math.round(\n          ((recentOrders.length - prevPeriodOrders.length) /\n            prevPeriodOrders.length) *\n            100,\n        )\n      : recentOrders.length > 0\n        ? 100\n        : 0;\n\n  const stats: DashboardStats = {\n    revenue,\n    activeOrders,\n    criticalStock: lowStockItems.length,\n    activeUniqueCustomers: uniqueCustomers.size,\n    totalCustomers,\n    avgOrderValue,\n    topBreed: topBreedName,\n    revenueChange,\n    ordersChange,\n  };\n\n  const analyticsData: AnalyticsData = {\n    revenueData,\n    topProducts,\n    categoryData,\n    wilayaData: wilayaStats,\n  };\n\n  return (\n    <div className=\"p-3 md:p-8 pb-10\">\n      <DashboardContent\n        stats={stats}\n        alerts={alerts}\n        forecasts={forecasts\n          .sort((a, b) => a.daysLeft - b.daysLeft)\n          .slice(0, 3)}\n        recentActivity={orders.slice(0, 10)}\n        analyticsData={analyticsData}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\products\\page.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\products\\page.tsx:85:18\n  83 |         .replace(/[^a-z0-9\\u0600-\\u06FF]+/g, \"-\")\n  84 |         .replace(/(^-|-$)+/g, \"\") ||\n> 85 |       `product-${Date.now()}`;\n     |                  ^^^^^^^^^^ Cannot call impure function\n  86 |\n  87 |     const payload: ProductInsert = {\n  88 |       name: newProduct.name_ar,","line":85,"column":18,"nodeType":null,"endLine":85,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport { useEffect, useState, useCallback } from \"react\";\nimport { createClient } from \"@/utils/supabase/client\";\nimport { Database } from \"@/types/supabase\";\nimport { cn } from \"@/lib/utils\";\n\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { AnimatedButton } from \"@/components/ui/AnimatedButton\";\nimport Link from \"next/link\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Plus, Trash2, Edit, Save, X } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\n\ntype Product = Database[\"public\"][\"Tables\"][\"products\"][\"Row\"];\ntype ProductInsert = Database[\"public\"][\"Tables\"][\"products\"][\"Insert\"];\n\ninterface ProductFormState {\n  name_en: string;\n  name_ar: string;\n  slug: string;\n  category: string;\n  subcategory: string;\n  price: string;\n  stock: string;\n  image_url: string;\n}\n\nexport default function ProductsPage() {\n  const supabase = createClient();\n  const [products, setProducts] = useState<Product[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isAdding, setIsAdding] = useState(false);\n  const [editingId, setEditingId] = useState<string | null>(null);\n\n  // Confirmation Modal State\n  const [confirmOpen, setConfirmOpen] = useState(false);\n  const [deletingId, setDeletingId] = useState<string | null>(null);\n\n  // New Product Form State\n  const [newProduct, setNewProduct] = useState<ProductFormState>({\n    name_en: \"\",\n    name_ar: \"\",\n    slug: \"\",\n    category: \"eggs\",\n    subcategory: \"Australorp Family\",\n    price: \"\",\n    stock: \"\",\n    image_url: \"\",\n  });\n\n  // Fetch Products\n  const fetchProducts = useCallback(async (showLoader = true) => {\n    if (showLoader) setLoading(true);\n    const { data, error } = await (supabase as any)\n      .from(\"products\")\n      .select(\n        \"id, name_en, name, slug, category, subcategory, price, stock, image_url, deleted_at\",\n      )\n      .is(\"deleted_at\", null) // Only fetch active products\n      .order(\"created_at\", { ascending: false });\n\n    if (data) setProducts(data);\n    if (error) console.error(\"Error fetching products:\", error);\n    if (showLoader) setLoading(false);\n  }, [supabase]);\n\n  useEffect(() => {\n    fetchProducts();\n  }, [fetchProducts]);\n\n  // Handle Add/Edit Product\n  const handleSaveProduct = async (e: React.FormEvent) => {\n    e.preventDefault();\n    const finalSlug =\n      newProduct.slug ||\n      (newProduct.name_en || newProduct.name_ar)\n        .toLowerCase()\n        .replace(/[^a-z0-9\\u0600-\\u06FF]+/g, \"-\")\n        .replace(/(^-|-$)+/g, \"\") ||\n      `product-${Date.now()}`;\n\n    const payload: ProductInsert = {\n      name: newProduct.name_ar,\n      name_en: newProduct.name_en,\n      slug: finalSlug,\n      category: newProduct.category,\n      subcategory: newProduct.subcategory,\n      price: Number(newProduct.price),\n      stock: Number(newProduct.stock),\n      image_url: newProduct.image_url || null,\n      is_active: true,\n    };\n\n    if (editingId) {\n      // Update existing product\n      const { error } = await supabase\n        .from(\"products\")\n        .update(payload)\n        .eq(\"id\", editingId);\n\n      if (error) {\n        toast.error(\"┘ü╪┤┘ä ╪¬╪¡╪»┘è╪½ ╪º┘ä┘à┘å╪¬╪¼: \" + error.message);\n        console.error(error);\n      } else {\n        toast.success(\"╪¬┘à ╪¬╪¡╪»┘è╪½ ╪º┘ä┘à┘å╪¬╪¼ ╪¿┘å╪¼╪º╪¡!\");\n        resetForm();\n        fetchProducts(false);\n      }\n    } else {\n      // Create new product\n      const { error } = await (supabase as any)\n        .from(\"products\")\n        .insert([payload]);\n\n      if (error) {\n        toast.error(\"┘ü╪┤┘ä ╪Ñ╪╢╪º┘ü╪⌐ ╪º┘ä┘à┘å╪¬╪¼: \" + error.message);\n        console.error(error);\n      } else {\n        toast.success(\"╪¬┘à╪¬ ╪Ñ╪╢╪º┘ü╪⌐ ╪º┘ä┘à┘å╪¬╪¼ ╪¿┘å╪¼╪º╪¡!\");\n        resetForm();\n        fetchProducts(false);\n      }\n    }\n  };\n\n  const handleEdit = (product: Product) => {\n    setEditingId(product.id);\n    setNewProduct({\n      name_en: product.name_en,\n      name_ar: product.name || \"\",\n      slug: product.slug || \"\",\n      category: product.category || \"eggs\",\n      subcategory: product.subcategory || \"\",\n      price: (product.price || 0).toString(),\n      stock: (product.stock || 0).toString(),\n      image_url: product.image_url || \"\",\n    });\n    setIsAdding(true);\n    // Scroll to form\n    window.scrollTo({ top: 0, behavior: \"smooth\" });\n  };\n\n  const handleDelete = async () => {\n    if (!deletingId) return;\n\n    const { error } = await supabase\n      .from(\"products\")\n      .update({ deleted_at: new Date().toISOString() })\n      .eq(\"id\", deletingId);\n\n    if (error) {\n      toast.error(\"┘ü╪┤┘ä ╪¡╪░┘ü ╪º┘ä┘à┘å╪¬╪¼: \" + error.message);\n      console.error(error);\n    } else {\n      toast.success(\"╪¬┘à ┘å┘é┘ä ╪º┘ä┘à┘å╪¬╪¼ ╪Ñ┘ä┘ë ╪│┘ä╪⌐ ╪º┘ä┘à╪¡╪░┘ê┘ü╪º╪¬\");\n      setProducts(products.filter((p) => p.id !== deletingId));\n    }\n    setConfirmOpen(false);\n    setDeletingId(null);\n  };\n\n  const resetForm = () => {\n    setIsAdding(false);\n    setEditingId(null);\n    setNewProduct({\n      name_en: \"\",\n      name_ar: \"\",\n      slug: \"\",\n      category: \"eggs\",\n      subcategory: \"Australorp Family\",\n      price: \"\",\n      stock: \"\",\n      image_url: \"\",\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <ConfirmDialog\n        isOpen={confirmOpen}\n        onClose={() => {\n          setConfirmOpen(false);\n          setDeletingId(null);\n        }}\n        onConfirm={handleDelete}\n        title=\"┘å┘é┘ä ╪Ñ┘ä┘ë ╪│┘ä╪⌐ ╪º┘ä┘à╪¡╪░┘ê┘ü╪º╪¬╪ƒ\"\n        description=\"┘ç┘ä ╪ú┘å╪¬ ┘à╪¬╪ú┘â╪» ┘à┘å ┘å┘é┘ä ┘ç╪░╪º ╪º┘ä┘à┘å╪¬╪¼ ╪Ñ┘ä┘ë ╪│┘ä╪⌐ ╪º┘ä┘à╪¡╪░┘ê┘ü╪º╪¬╪ƒ ┘è┘à┘â┘å ╪º╪│╪¬╪╣╪º╪»╪¬┘ç ┘ä╪º╪¡┘é╪º┘ï.\"\n        confirmText=\"┘å┘é┘ä ┘ä┘ä╪│┘ä╪⌐\"\n        variant=\"destructive\"\n      />\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\n        <div>\n          <h1 className=\"text-4xl font-black tracking-tighter\">\n            ┘à╪»┘è╪▒ ╪º┘ä┘à╪«╪▓┘ê┘å ╪º┘ä╪┤╪º┘à┘ä\n          </h1>\n          <p className=\"text-muted-foreground font-black\">\n            ╪Ñ╪»╪º╪▒╪⌐ ╪¼┘à┘è╪╣ ┘à┘å╪¬╪¼╪º╪¬ ╪º┘ä┘à╪▓╪▒╪╣╪⌐ ┘ê╪¬╪¬╪¿╪╣ ┘à╪│╪¬┘ê┘è╪º╪¬ ╪º┘ä╪¬┘ê┘ü╪▒.\n          </p>\n        </div>\n        <div className=\"flex gap-3\">\n          <Link href=\"/products/recycle-bin\">\n            <AnimatedButton\n              variant=\"outline\"\n              className=\"rounded-xl h-12 bg-white dark:bg-card border-none shadow-md text-red-500 font-black\"\n            >\n              <Trash2 className=\"ms-2 h-4 w-4\" /> ╪│┘ä╪⌐ ╪º┘ä┘à╪¡╪░┘ê┘ü╪º╪¬\n            </AnimatedButton>\n          </Link>\n          {!isAdding && (\n            <AnimatedButton\n              onClick={() => setIsAdding(true)}\n              className=\"rounded-xl h-12 px-6 bg-emerald-600 text-white shadow-lg shadow-emerald-500/20 font-black\"\n            >\n              <Plus className=\"ms-2 h-5 w-5\" /> ╪Ñ╪╢╪º┘ü╪⌐ ┘à┘å╪¬╪¼\n            </AnimatedButton>\n          )}\n        </div>\n      </div>\n\n      {/* Add/Edit Product Form (Collapsible) */}\n      {isAdding && (\n        <Card\n          className={`border border-border/40 shadow-sm rounded-xl overflow-hidden ${editingId ? \"bg-blue-50/30 dark:bg-blue-950/10\" : \"bg-emerald-50/30 dark:bg-emerald-950/10\"}`}\n        >\n          <CardHeader className=\"flex flex-row items-center justify-between p-8\">\n            <CardTitle className=\"text-xl font-black\">\n              {editingId ? \"╪¬╪╣╪»┘è┘ä ╪º┘ä┘à┘å╪¬╪¼\" : \"╪Ñ╪╢╪º┘ü╪⌐ ┘à╪º╪»╪⌐ ╪¼╪»┘è╪»╪⌐\"}\n            </CardTitle>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={resetForm}\n              className=\"rounded-xl\"\n            >\n              <X className=\"h-5 w-5\" />\n            </Button>\n          </CardHeader>\n          <CardContent className=\"p-8 pt-0\">\n            <form\n              onSubmit={handleSaveProduct}\n              className=\"grid gap-6 md:grid-cols-2\"\n            >\n              <div className=\"grid gap-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ╪º┘ä╪º╪│┘à ╪¿╪º┘ä╪Ñ┘å╪¼┘ä┘è╪▓┘è╪⌐\n                </Label>\n                <Input\n                  required\n                  placeholder=\"┘à╪½╪º┘ä: Brahma Gold\"\n                  value={newProduct.name_en}\n                  onChange={(e) => {\n                    const name = e.target.value;\n                    const slug = name\n                      .toLowerCase()\n                      .replace(/[^a-z0-9]+/g, \"-\")\n                      .replace(/(^-|-$)+/g, \"\");\n                    setNewProduct({ ...newProduct, name_en: name, slug: slug });\n                  }}\n                  className=\"h-12 rounded-xl bg-muted/50 border-none font-black\"\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ╪º┘ä╪º╪│┘à ╪¿╪º┘ä╪╣╪▒╪¿┘è╪⌐\n                </Label>\n                <Input\n                  placeholder=\"┘à╪½╪º┘ä: ╪¿╪▒╪º┘ç┘à╪º ╪░┘ç╪¿┘è\"\n                  value={newProduct.name_ar}\n                  onChange={(e) =>\n                    setNewProduct({ ...newProduct, name_ar: e.target.value })\n                  }\n                  className=\"h-12 rounded-xl bg-muted/50 border-none font-black text-right\"\n                />\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ╪º┘ä┘à╪╣╪▒┘ü ╪º┘ä╪¿╪▒┘à╪¼┘è (Slug)\n                </Label>\n                <Input\n                  placeholder=\"┘è╪¬┘à ╪¬┘ê┘ä┘è╪»┘ç ╪¬┘ä┘é╪º╪ª┘è╪º┘ï\"\n                  value={newProduct.slug}\n                  onChange={(e) =>\n                    setNewProduct({ ...newProduct, slug: e.target.value })\n                  }\n                  className=\"h-12 rounded-xl bg-muted/50 border-none font-mono text-sm\"\n                />\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ╪º┘ä┘ü╪ª╪⌐ ╪º┘ä╪ú╪│╪º╪│┘è╪⌐\n                </Label>\n                <select\n                  className=\"flex h-12 w-full rounded-xl border-none bg-muted/50 px-4 py-2 text-sm font-black outline-none focus:ring-4 focus:ring-emerald-500/10 transition-all\"\n                  value={newProduct.category}\n                  onChange={(e) =>\n                    setNewProduct({ ...newProduct, category: e.target.value })\n                  }\n                >\n                  <option value=\"eggs\">╪¿┘è╪╢ ╪º┘ä╪¬┘ü┘é┘è╪│</option>\n                  <option value=\"chicks\">╪╡┘è╪╡╪º┘å</option>\n                  <option value=\"chickens\">╪»┘ê╪º╪¼┘å ╪¿╪º┘ä╪║╪⌐</option>\n                  <option value=\"machine\">╪¡╪º╪╢┘å╪º╪¬ ┘ê┘à╪╣╪»╪º╪¬</option>\n                </select>\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ╪º┘ä┘ü╪ª╪⌐ ╪º┘ä┘ü╪▒╪╣┘è╪⌐\n                </Label>\n                <select\n                  className=\"flex h-12 w-full rounded-xl border-none bg-muted/50 px-4 py-2 text-sm font-black outline-none focus:ring-4 focus:ring-emerald-500/10 transition-all\"\n                  value={newProduct.subcategory}\n                  onChange={(e) =>\n                    setNewProduct({\n                      ...newProduct,\n                      subcategory: e.target.value,\n                    })\n                  }\n                >\n                  <option value=\"Australorp Family\">╪ú╪│╪¬╪▒╪º┘ä┘ê╪▒╪¿</option>\n                  <option value=\"Plymouth Rock Family\">╪¿┘ä┘è┘à┘ê╪½ ╪▒┘ê┘â</option>\n                  <option value=\"Brahma Family\">╪¿╪▒╪º┘ç┘à╪º</option>\n                  <option value=\"Sprite Family\">╪│╪¿╪▒┘è╪¬</option>\n                  <option value=\"Other Breeds\">╪│┘ä╪º┘ä╪º╪¬ ╪ú╪«╪▒┘ë</option>\n                  <option value=\"Incubator\">╪¡╪º╪╢┘å╪⌐</option>\n                </select>\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ╪º┘ä╪│╪╣╪▒ (╪»╪¼)\n                </Label>\n                <Input\n                  required\n                  type=\"number\"\n                  placeholder=\"0\"\n                  value={newProduct.price}\n                  onChange={(e) =>\n                    setNewProduct({ ...newProduct, price: e.target.value })\n                  }\n                  className=\"h-12 rounded-xl bg-muted/50 border-none font-black\"\n                />\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground me-1\">\n                  ┘â┘à┘è╪⌐ ╪º┘ä┘à╪«╪▓┘ê┘å\n                </Label>\n                <Input\n                  required\n                  type=\"number\"\n                  placeholder=\"0\"\n                  value={newProduct.stock}\n                  onChange={(e) =>\n                    setNewProduct({ ...newProduct, stock: e.target.value })\n                  }\n                  className=\"h-12 rounded-xl bg-muted/50 border-none font-black\"\n                />\n              </div>\n\n              <div className=\"col-span-2 flex gap-4 mt-4\">\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1 h-14 rounded-xl bg-emerald-600 text-white shadow-sm font-black text-lg hover:bg-emerald-700\"\n                >\n                  {editingId ? \"╪¬╪╣╪»┘è┘ä ╪º┘ä╪¿┘è╪º┘å╪º╪¬\" : \"╪¡┘ü╪╕ ╪º┘ä┘à┘å╪¬╪¼ ╪º┘ä╪¼╪»┘è╪»\"}\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={resetForm}\n                  className=\"h-14 px-8 rounded-xl font-black\"\n                >\n                  ╪Ñ┘ä╪║╪º╪í\n                </Button>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card className=\"border border-border/40 shadow-sm rounded-xl bg-white dark:bg-card overflow-hidden\">\n        <CardHeader className=\"p-8 pb-4\">\n          <CardTitle className=\"text-xl font-black\">\n            ╪º┘ä┘à╪«╪▓┘ê┘å ╪º┘ä╪¡╪º┘ä┘è ({products.length})\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"px-0 sm:px-6\">\n          <div className=\"overflow-x-auto px-4 pb-4 sm:px-0 sm:pb-0\">\n            <table className=\"w-full text-sm text-right min-w-[800px]\">\n              <thead className=\"text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground bg-muted/30\">\n                <tr>\n                  <th className=\"px-8 py-4\">╪º┘ä┘à┘å╪¬╪¼</th>\n                  <th className=\"px-8 py-4\">╪º┘ä┘ü╪ª╪⌐</th>\n                  <th className=\"px-8 py-4\">╪º┘ä╪│╪╣╪▒ (╪»╪¼)</th>\n                  <th className=\"px-8 py-4 text-center\">╪º┘ä┘à╪«╪▓┘ê┘å</th>\n                  <th className=\"px-8 py-4 text-center\">╪º┘ä╪¡╪º┘ä╪⌐</th>\n                  <th className=\"px-8 py-4 text-left\">╪Ñ╪¼╪▒╪º╪í╪º╪¬</th>\n                </tr>\n              </thead>\n              <tbody>\n                {products.map((product) => (\n                  <tr\n                    key={product.id}\n                    className=\"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-emerald-50/30 transition-colors\"\n                  >\n                    <td className=\"px-6 py-4 font-black\">\n                      <div className=\"text-lg\">{product.name_en}</div>\n                      <div className=\"text-xs text-muted-foreground opacity-50 font-mono\">\n                        #{product.id.substring(0, 8)}\n                      </div>\n                    </td>\n                    <td className=\"px-8 py-5 capitalize\">\n                      <Badge\n                        variant=\"outline\"\n                        className=\"rounded-full px-3 py-1 border-emerald-200 dark:border-emerald-500/30 bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 font-black\"\n                      >\n                        {product.subcategory}\n                      </Badge>\n                    </td>\n                    <td className=\"px-8 py-5 font-black text-lg\">\n                      {product.price?.toLocaleString()}\n                    </td>\n                    <td className=\"px-8 py-5 text-center font-black\">\n                      <div\n                        className={cn(\n                          \"text-2xl font-black px-4 py-1.5 rounded-xl inline-block shadow-sm\",\n                          (product.stock ?? 0) < 10\n                            ? \"bg-red-50 dark:bg-red-500/10 text-red-600 border border-red-100\"\n                            : \"bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 border border-emerald-100 dark:border-emerald-500/20\",\n                        )}\n                      >\n                        {product.stock ?? 0}\n                      </div>\n                    </td>\n                    <td className=\"px-8 py-5 text-center\">\n                      <Badge\n                        className={cn(\n                          \"rounded-full px-3 py-1 font-black border-none\",\n                          (product.stock ?? 0) > 0\n                            ? \"bg-emerald-100 dark:bg-emerald-500/20 text-emerald-600\"\n                            : \"bg-red-100 dark:bg-red-500/20 text-red-600\",\n                        )}\n                      >\n                        {(product.stock ?? 0) > 0 ? \"┘à╪¬┘ê┘ü╪▒\" : \"╪¬┘å┘ü╪░\"}\n                      </Badge>\n                    </td>\n                    <td className=\"px-8 py-5 text-left\">\n                      <div className=\"flex gap-2\">\n                        <AnimatedButton\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 text-blue-500 hover:text-blue-600 hover:bg-blue-50 dark:bg-blue-500/10 rounded-xl\"\n                          onClick={() => handleEdit(product)}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </AnimatedButton>\n                        <AnimatedButton\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:bg-red-500/10 rounded-xl\"\n                          onClick={() => {\n                            setDeletingId(product.id);\n                            setConfirmOpen(true);\n                          }}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </AnimatedButton>\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n                {products.length === 0 && !loading && (\n                  <tr>\n                    <td\n                      colSpan={6}\n                      className=\"px-8 py-20 text-center text-muted-foreground font-black opacity-30\"\n                    >\n                      ┘ä╪º ┘è┘ê╪¼╪» ┘à╪«╪▓┘ê┘å ╪¡╪º┘ä┘è╪º┘ï. ╪ú╪╢┘ü ╪¿╪╣╪╢ ╪º┘ä┘à┘å╪¬╪¼╪º╪¬ ┘ä┘ä╪¿╪»╪í!\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\products\\recycle-bin\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Administrator\\Desktop\\my-online-shop\\admin-dashboard\\app\\(dashboard)\\products\\recycle-bin\\page.tsx:47:5\n  45 |\n  46 |   useEffect(() => {\n> 47 |     fetchDeletedProducts();\n     |     ^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  48 |   }, []);\n  49 |\n  50 |   const handleRestore = async (id: string) => {","line":47,"column":5,"nodeType":null,"endLine":47,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { createClient } from \"@/utils/supabase/client\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { AnimatedButton } from \"@/components/ui/AnimatedButton\";\nimport { RefreshCcw, Trash2, ArrowLeft } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport Link from \"next/link\";\nimport ChickenLoader from \"@/components/ui/chicken-loader\";\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\nexport default function RecycleBinPage() {\n  const [deletedProducts, setDeletedProducts] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedItems, setSelectedItems] = useState<string[]>([]);\n  const [itemToDelete, setItemToDelete] = useState<string | null>(null);\n\n  // Confirmation Modal State\n  const [confirmAction, setConfirmAction] = useState<\n    \"single\" | \"bulk_delete\" | \"empty_trash\" | null\n  >(null);\n\n  const supabase = createClient();\n\n  // Fetch Deleted Products\n  const fetchDeletedProducts = async () => {\n    setLoading(true);\n    const { data, error } = await supabase\n      .from(\"products\")\n      .select(\"id, name_en, subcategory, price, deleted_at\")\n      .not(\"deleted_at\", \"is\", null) // Fetch only deleted items\n      .order(\"created_at\", { ascending: false });\n\n    if (data) setDeletedProducts(data);\n    if (error) {\n      console.error(\"Error fetching deleted products:\", error);\n      toast.error(\n        'Failed to load recycle bin. Ensure \"deleted_at\" column exists.',\n      );\n    }\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    fetchDeletedProducts();\n  }, []);\n\n  const handleRestore = async (id: string) => {\n    const { error } = await supabase\n      .from(\"products\")\n      .update({\n        deleted_at: null,\n        is_active: true, // Keep both in sync for now\n      })\n      .eq(\"id\", id);\n\n    if (error) {\n      toast.error(\"Error restoring product\");\n    } else {\n      toast.success(\"Product restored successfully\");\n      setDeletedProducts(deletedProducts.filter((p) => p.id !== id));\n    }\n  };\n\n  const handlePermanentDelete = async () => {\n    if (!itemToDelete) return;\n\n    const { error } = await supabase\n      .from(\"products\")\n      .delete()\n      .eq(\"id\", itemToDelete);\n\n    if (error) {\n      toast.error(\"Error deleting product permanently\");\n    } else {\n      toast.success(\"Product deleted permanently\");\n      setDeletedProducts(deletedProducts.filter((p) => p.id !== itemToDelete));\n      setSelectedItems((prev) => prev.filter((id) => id !== itemToDelete));\n    }\n\n    setConfirmAction(null);\n    setItemToDelete(null);\n  };\n\n  const handleBulkRestore = async () => {\n    if (!selectedItems.length) return;\n    const { error } = await supabase\n      .from(\"products\")\n      .update({ deleted_at: null, is_active: true })\n      .in(\"id\", selectedItems);\n\n    if (error) {\n      toast.error(\"Error restoring products\");\n    } else {\n      toast.success(`${selectedItems.length} products restored`);\n      setDeletedProducts(\n        deletedProducts.filter((p) => !selectedItems.includes(p.id)),\n      );\n      setSelectedItems([]);\n    }\n  };\n\n  const handleBulkDelete = async () => {\n    if (!selectedItems.length) return;\n    const { error } = await supabase\n      .from(\"products\")\n      .delete()\n      .in(\"id\", selectedItems);\n\n    if (error) {\n      toast.error(\"Error deleting products permanently\");\n    } else {\n      toast.success(`${selectedItems.length} products deleted permanently`);\n      setDeletedProducts(\n        deletedProducts.filter((p) => !selectedItems.includes(p.id)),\n      );\n      setSelectedItems([]);\n    }\n    setConfirmAction(null);\n  };\n\n  const handleEmptyTrash = async () => {\n    const { error } = await supabase\n      .from(\"products\")\n      .delete()\n      .not(\"deleted_at\", \"is\", null);\n\n    if (error) {\n      toast.error(\"Error emptying trash\");\n    } else {\n      toast.success(\"Trash emptied successfully\");\n      setDeletedProducts([]);\n      setSelectedItems([]);\n    }\n    setConfirmAction(null);\n  };\n\n  const toggleSelectAll = () => {\n    if (selectedItems.length === deletedProducts.length) {\n      setSelectedItems([]);\n    } else {\n      setSelectedItems(deletedProducts.map((p) => p.id));\n    }\n  };\n\n  const toggleSelect = (id: string) => {\n    setSelectedItems((prev) =>\n      prev.includes(id) ? prev.filter((i) => i !== id) : [...prev, id],\n    );\n  };\n\n  if (loading) return <ChickenLoader mode=\"dashboard\" />;\n\n  return (\n    <div className=\"space-y-6\">\n      <ConfirmDialog\n        isOpen={confirmAction !== null}\n        onClose={() => {\n          setConfirmAction(null);\n          setItemToDelete(null);\n        }}\n        onConfirm={() => {\n          if (confirmAction === \"single\") handlePermanentDelete();\n          else if (confirmAction === \"bulk_delete\") handleBulkDelete();\n          else if (confirmAction === \"empty_trash\") handleEmptyTrash();\n        }}\n        title=\"Permanently Delete?\"\n        description=\"This action cannot be undone. The product(s) will be removed from the database forever.\"\n        confirmText=\"Delete Forever\"\n        variant=\"destructive\"\n      />\n      <div className=\"flex flex-col md:flex-row md:items-center gap-4 justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Link href=\"/inventory/breeds\">\n            <AnimatedButton\n              variant=\"outline\"\n              size=\"icon\"\n              className=\"rounded-xl h-12 w-12 bg-white dark:bg-card border-none shadow-md\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </AnimatedButton>\n          </Link>\n          <div>\n            <h1 className=\"text-4xl font-black tracking-tighter flex items-center gap-4\">\n              <Trash2 className=\"h-10 w-10 text-red-500\" />\n              ╪│┘ä╪⌐ ╪º┘ä┘à╪¡╪░┘ê┘ü╪º╪¬\n            </h1>\n            <p className=\"text-muted-foreground font-black\">\n              ╪º╪│╪¬╪╣╪º╪»╪⌐ ╪º┘ä╪╣┘å╪º╪╡╪▒ ╪º┘ä┘à╪¡╪░┘ê┘ü╪⌐ ╪ú┘ê ╪Ñ╪▓╪º┘ä╪¬┘ç╪º ┘å┘ç╪º╪ª┘è╪º┘ï ┘à┘å ╪º┘ä┘å╪╕╪º┘à.\n            </p>\n          </div>\n        </div>\n\n        {deletedProducts.length > 0 && (\n          <AnimatedButton\n            variant=\"outline\"\n            onClick={() => setConfirmAction(\"empty_trash\")}\n            className=\"rounded-xl h-12 px-6 bg-red-50 dark:bg-red-500/10 text-red-600 hover:bg-red-100 dark:bg-red-500/20 hover:text-red-700 font-black border-red-200\"\n          >\n            <Trash2 className=\"h-5 w-5 ms-2\" /> ╪¬┘ü╪▒┘è╪║ ╪º┘ä╪│┘ä╪⌐\n          </AnimatedButton>\n        )}\n      </div>\n\n      <Card className=\"border-none shadow-xl rounded-xl bg-white dark:bg-card overflow-hidden\">\n        <CardHeader className=\"p-4 md:p-8 md:pb-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n          <CardTitle className=\"text-xl font-black\">\n            ╪º┘ä╪╣┘å╪º╪╡╪▒ ╪º┘ä┘à╪¡╪░┘ê┘ü╪⌐ ({deletedProducts.length})\n          </CardTitle>\n          {selectedItems.length > 0 && (\n            <div className=\"flex items-center gap-2 bg-muted/50 p-1.5 rounded-xl border border-border/50\">\n              <span className=\"text-xs font-black text-muted-foreground px-3\">\n                {selectedItems.length} ┘à╪¡╪»╪»\n              </span>\n              <AnimatedButton\n                disabled={loading}\n                size=\"sm\"\n                onClick={handleBulkRestore}\n                className=\"min-h-[48px] px-4 rounded-lg bg-emerald-600 hover:bg-emerald-700 font-black text-white\"\n              >\n                <RefreshCcw className=\"h-4 w-4 ms-2\" /> ╪º╪│╪¬╪╣╪º╪»╪⌐\n              </AnimatedButton>\n              <AnimatedButton\n                disabled={loading}\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => setConfirmAction(\"bulk_delete\")}\n                className=\"min-h-[48px] px-4 rounded-lg text-red-500 hover:text-red-700 hover:bg-red-50 dark:bg-red-500/10 font-black\"\n              >\n                <Trash2 className=\"h-4 w-4 ms-2\" /> ╪¡╪░┘ü\n              </AnimatedButton>\n            </div>\n          )}\n        </CardHeader>\n        <CardContent className=\"p-0 md:p-6 md:pt-0\">\n          {/* Desktop Table View */}\n          <div className=\"hidden md:block overflow-x-auto\">\n            <table className=\"w-full text-sm text-right\">\n              <thead className=\"text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground bg-muted/30\">\n                <tr>\n                  <th className=\"px-6 py-4 w-12 text-center\">\n                    <Checkbox\n                      checked={\n                        selectedItems.length === deletedProducts.length &&\n                        deletedProducts.length > 0\n                      }\n                      onCheckedChange={toggleSelectAll}\n                    />\n                  </th>\n                  <th className=\"px-8 py-4\">╪º┘ä┘à┘å╪¬╪¼</th>\n                  <th className=\"px-8 py-4\">╪º┘ä┘ü╪ª╪⌐</th>\n                  <th className=\"px-8 py-4\">╪º┘ä╪│╪╣╪▒</th>\n                  <th className=\"px-8 py-4 text-left\">╪Ñ╪¼╪▒╪º╪í╪º╪¬</th>\n                </tr>\n              </thead>\n              <tbody>\n                {deletedProducts.map((product) => (\n                  <tr\n                    key={product.id}\n                    className={`bg-white border-b dark:bg-gray-800 dark:border-gray-700 transition-colors ${selectedItems.includes(product.id) ? \"bg-emerald-50/40 dark:bg-emerald-900/10\" : \"hover:bg-emerald-50/10 dark:hover:bg-emerald-900/5\"}`}\n                  >\n                    <td className=\"px-6 py-5 text-center\">\n                      <Checkbox\n                        checked={selectedItems.includes(product.id)}\n                        onCheckedChange={() => toggleSelect(product.id)}\n                      />\n                    </td>\n                    <td className=\"px-8 py-5 font-black\">\n                      <div className=\"text-lg\">{product.name_en}</div>\n                      <div className=\"text-xs text-muted-foreground opacity-50 font-mono\">\n                        #{product.id.slice(0, 8)}\n                      </div>\n                    </td>\n                    <td className=\"px-8 py-5 capitalize\">\n                      <Badge\n                        variant=\"outline\"\n                        className=\"rounded-full px-3 py-1 border-emerald-200 dark:border-emerald-500/30 bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 font-black\"\n                      >\n                        {product.subcategory}\n                      </Badge>\n                    </td>\n                    <td className=\"px-8 py-5 font-black text-lg\">\n                      {product.price?.toLocaleString()}{\" \"}\n                      <span className=\"text-xs opacity-50\">╪»╪¼</span>\n                    </td>\n                    <td className=\"px-8 py-5 text-left flex justify-start gap-3\">\n                      <AnimatedButton\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"h-10 rounded-xl px-4 text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50 dark:bg-emerald-500/10 border-emerald-200 dark:border-emerald-500/30 font-black\"\n                        onClick={() => handleRestore(product.id)}\n                      >\n                        <RefreshCcw className=\"h-4 w-4 ms-2\" /> ╪º╪│╪¬╪╣╪º╪»╪⌐\n                      </AnimatedButton>\n                      <AnimatedButton\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-10 w-10 rounded-xl p-0 text-red-500 hover:text-red-700 hover:bg-red-50 dark:bg-red-500/10\"\n                        onClick={() => {\n                          setItemToDelete(product.id);\n                          setConfirmAction(\"single\");\n                        }}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </AnimatedButton>\n                    </td>\n                  </tr>\n                ))}\n                {deletedProducts.length === 0 && (\n                  <tr>\n                    <td\n                      colSpan={5}\n                      className=\"px-8 py-20 text-center text-muted-foreground font-black opacity-30\"\n                    >\n                      ╪│┘ä╪⌐ ╪º┘ä┘à╪¡╪░┘ê┘ü╪º╪¬ ┘ü╪º╪▒╪║╪⌐. ╪ú╪¡╪│┘å╪¬! ΓÖ╗∩╕Å\n                    </td>\n                  </tr>\n                )}\n              </tbody>\n            </table>\n          </div>\n\n          {/* Mobile Cards View */}\n          <div className=\"md:hidden grid gap-0 divide-y divide-border/30 border-t border-border/30\">\n            {deletedProducts.length > 0 && (\n              <div className=\"p-4 bg-muted/30 flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <Checkbox\n                    checked={\n                      selectedItems.length === deletedProducts.length &&\n                      deletedProducts.length > 0\n                    }\n                    onCheckedChange={toggleSelectAll}\n                  />\n                  <span className=\"text-xs font-black uppercase tracking-widest text-muted-foreground\">\n                    ╪¬╪¡╪»┘è╪» ╪º┘ä┘â┘ä\n                  </span>\n                </div>\n              </div>\n            )}\n            {deletedProducts.map((product) => (\n              <div\n                key={product.id}\n                className={`p-4 flex gap-4 items-center transition-colors ${selectedItems.includes(product.id) ? \"bg-emerald-50/40 dark:bg-emerald-900/10\" : \"\"}`}\n              >\n                <Checkbox\n                  checked={selectedItems.includes(product.id)}\n                  onCheckedChange={() => toggleSelect(product.id)}\n                />\n                <div className=\"flex-1 min-w-0\">\n                  <h3 className=\"text-base font-black truncate leading-none mb-1\">\n                    {product.name_en}\n                  </h3>\n                  <p className=\"text-xs text-muted-foreground font-medium uppercase truncate\">\n                    {product.subcategory}\n                  </p>\n                  <div className=\"text-sm font-black mt-1\">\n                    {product.price?.toLocaleString()} ╪»╪¼\n                  </div>\n                </div>\n                <div className=\"flex flex-col gap-2 shrink-0\">\n                  <AnimatedButton\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"h-10 w-10 text-emerald-600 border-emerald-200 dark:border-emerald-500/30 bg-emerald-50 dark:bg-emerald-500/10 rounded-xl p-0\"\n                    onClick={() => handleRestore(product.id)}\n                  >\n                    <RefreshCcw className=\"h-4 w-4\" />\n                  </AnimatedButton>\n                  <AnimatedButton\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"h-10 w-10 text-red-500 border-red-200 bg-red-50 dark:bg-red-500/10 rounded-xl p-0\"\n                    onClick={() => {\n                      setItemToDelete(product.id);\n                      setConfirmAction(\"single\");\n                    }}\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </AnimatedButton>\n                </div>\n              </div>\n            ))}\n            {deletedProducts.length === 0 && (\n              <div className=\"p-12 text-center text-muted-foreground font-black opacity-30\">\n                ╪│┘ä╪⌐ ╪º┘ä┘à╪¡╪░┘ê┘ü╪º╪¬ ┘ü╪º╪▒╪║╪⌐. ΓÖ╗∩╕Å\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]}]
